var WebFontConfig,main;main=function(){var e,t,n,o,r,a,l,i,d,s,c,h,u,f,p,g,v,y,w,m,b,T,k,x,P,S,C,A,E,I,B,D,O,M,H,_,F,L,N,j,G,R,U,W,q,Y,K,V,z,J,Z,Q,X,ee,te,ne,oe,re,ae,le,ie,de,se,ce,he,ue,fe,pe,ge,ve,ye,we,me,be,Te,ke,xe,Pe,Se,Ce,Ae,Ee,Ie,Be,De,Oe;h="flappy",e=!1,c=160,n=1100,t=320,s=1/1200,i=100,d=1,l=6,a=384,u=500,o=64,r=a-o,oe=document.querySelector("#screen"),L=void 0,D=void 0,S=[],P=[],x=[],J=[{name:"Arpit",score:"58",hall:"AZ"},{name:"Apoorv",score:"2",hall:"NH"},{name:"Vikrant",score:"1",hall:"RP"},{name:"Arkanath",score:"100",hall:"MS"}],U=["AZ","MT","RP","SN","NH","PT","RK","LLR","MS","LBS","MMM","HJB"],b=null,z=!1,R=!1,v=null,Be=null,V=null,y=null,j=null,G=null,O=null,te=null,Z=null,ee=null,ge=null,re=null,ue=null,pe=null,K=null,F=null,Ie=null,H=null,_=null,ae=null,E=null,fe=null,Y=null,C=null,Ee=null,q=null,T=null,De=null,Te=null,ne=12,w=null,Q=null,N='<iframe src="http://ghbtns.com/github-btn.html?user=korroktheslavemaster&repo=flappy-kgp&type=watch&count=true&size=large"\nallowtransparency="true" frameborder="0" scrolling="0" width="150" height="30"></iframe>',I=Math.floor,de=function(e,t){var n,o,r;for(o="",n=r=e;1>=e?1>=r:r>=1;n=1>=e?++r:--r)o+=t[Math.floor(Math.random()*t.length)];return o},ke=function(e,t){var n,o,r;return n=null,o=t?"tubeTop":"tubeBottom",r=I(t?e-i/2-320:e+i/2),S.length>0&&"tubeTop"===o?(n=S.pop().revive(),n.reset(B.world.width,r)):P.length>0&&"tubeBottom"===o?(n=P.pop().revive(),n.reset(B.world.width,r)):(n=Be.create(B.world.width,r,o),B.physics.arcade.enableBody(n),n.body.allowGravity=!1),n.body.velocity.x=-c,n},xe=function(){var e,t,n,o;Be.forEachAlive(function(e){e.x+e.width<B.world.bounds.left&&("tubeTop"===e.key&&S.push(e.kill()),"tubeBottom"===e.key&&P.push(e.kill()))}),V.forEachAlive(function(e){e.x+e.width<B.world.bounds.left&&x.push(e.kill())}),o=B.world.height/2+(Math.random()-.5)*B.world.height*.2,e=ke(o),n=ke(o,!0),x.length>0?t=x.pop().revive().reset(n.x+n.width/2,0):(t=V.create(n.x+n.width/2,0),B.physics.arcade.enableBody(t),t.width=2,t.height=B.world.height,t.body.allowGravity=!1),t.body.velocity.x=-c},g=function(e,t){V.remove(t),ue+=1,pe.setText(ue),fe.play()},we=function(e){var t,n,o,r,a,l,i;for(o="",n="",r="",Z.children[1].setText("Loading.."),Z.children[2].setText(""),Z.children[0].setText(""),a=l=3,i=Z.children.length-1;i>=3?i>=l:l>=i;a=i>=3?++l:--l)Z.children[a].kill();return Z.children[9].revive(),Z.children[10].revive(),t=function(){var e,t,a,l;for(t=a=0,l=J.length-1;l>=0?l>=a:a>=l;t=l>=0?++a:--a)J[t].score<0?(o+="\n-",n+="\n---",r+="\n---",Z.children[3+t].kill()):(o+="\n"+(t+1),n+="\n"+J[t].hall,r+="\n"+J[t].score,e=Z.children[3+t],e.revive(),e.frameName=J[t].hall+"/2",e.children[0].setText(J[t].hall));return Z.children[0].setText(o),Z.children[1].setText(n),Z.children[2].setText(r),Z.children[9].bringToTop()},$.when(e).done(function(e){return $.ajax({type:"GET",url:"/getLeaderboardHall",success:function(e){return J=e,he(),t()},error:function(){return J=[],he(),t()}})})},me=function(e){var t,n,o,r,a,l,i;for(o="",n="",r="",Z.children[1].setText("Loading.."),Z.children[2].setText(""),Z.children[0].setText(""),a=l=3,i=Z.children.length-1;i>=3?i>=l:l>=i;a=i>=3?++l:--l)Z.children[a].kill();return Z.children[9].revive(),Z.children[10].revive(),t=function(){var e,t,a,l;for(t=a=0,l=J.length-1;l>=0?l>=a:a>=l;t=l>=0?++a:--a)J[t].score<0?(o+="\n-",n+="\n---",r+="\n---",Z.children[3+t].kill()):(o+="\n"+(t+1),n+="\n"+J[t].name,r+="\n"+J[t].score,e=Z.children[3+t],e.revive(),e.frameName=J[t].hall+"/2",e.children[0].setText(J[t].hall));return Z.children[0].setText(o),Z.children[1].setText(n),Z.children[2].setText(r),Z.children[9].bringToTop()},$.when(e).done(function(e){return $.ajax({type:"GET",url:"/getLeaderboardSolo",success:function(e){return J=e,he(),t()},error:function(){return J=[],he(),t()}})})},he=function(){for(J.sort(function(e,t){return parseInt(e.score)<parseInt(t.score)});J.length<l;)J.push({name:"---",score:"-1",hall:"DUMMY2"});return J},ve=function(){var e;return e={score:ue,name:re,hall:U[b],key:ge,token:W(ue+ge+h+ue)},$.ajax({type:"POST",data:e,dataType:"text",url:"/sendScore",success:function(e){},error:function(){}})},be=function(){var e,t;return Z.frame=0,e=ve(),Q.input.enabled=!1,O.alive?(t=B.add.tween(O).to({y:1.5*B.world.height},800,Phaser.Easing.Back.In,!0),Ee.play(),Te.onDown.removeAll(),v.events.onInputDown.removeAll(),t.onComplete.add(function(){return O.kill(),Z.revive(),Z.bringToTop(),t=B.add.tween(Z).to({y:B.world.height/2},800,Phaser.Easing.Back.Out,!0),we(e),t.onComplete.add(function(){var e;return e=function(){return Z.alive?(t=B.add.tween(Z).to({y:1.5*B.world.height},800,Phaser.Easing.Back.In,!0),Ee.play(),Te.onDown.removeAll(),v.events.onInputDown.removeAll(),t.onComplete.add(function(){return Z.kill(),ce()})):ce()},v.events.onInputDown.addOnce(e),Te.onDown.addOnce(e)})})):void 0},p=function(e,t,n){var o;return o=B.add.sprite(e,t,"sheet",U[n]+"/2"),o.scale.setTo(2,2),o.smoothed=!1,o.anchor.setTo(.5,.5),o},Se=function(){return v.inputEnabled=!1,Te.onDown.removeAll(),ae.startFocus(),ae.focus=!0,ae.placeHolder.visible=!1},Ae=function(){return ae.endFocus(),ae.focus=!1,v.inputEnabled=!0},M=function(){var e;return Te.onDown.removeAll(),v.events.onInputDown.removeAll(),O.revive(),Q.input.enabled=!1,O.bringToTop(),e=B.add.tween(O).to({y:B.world.height/2},800,Phaser.Easing.Back.Out,!0),e.onComplete.add(function(){var t;return Q.input.enabled=!0,t=function(){return ve(),Q.input.enabled=!1,O.alive?(e=B.add.tween(O).to({y:1.5*B.world.height},800,Phaser.Easing.Back.In,!0),Ee.play(),Te.onDown.removeAll(),v.events.onInputDown.removeAll(),e.onComplete.add(function(){return O.kill(),ce()})):ce()},v.events.onInputDown.addOnce(t),Te.onDown.addOnce(t)}),Ee.play()},ye=function(){var e;D=!0,y.body.velocity.y>0&&(y.body.velocity.y=100),y.animations.stop(),y.frame=U[b]+"/2",e=window.localStorage.getItem("hiscore"),e=e?e:ue,e=ue>parseInt(e,10)?ue:e,window.localStorage.setItem("hiscore",e),H.setText(ue),_.setText(e),Be.forEachAlive(function(e){e.body.velocity.x=0}),V.forEach(function(e){e.body.velocity.x=0}),B.time.events.remove(De),B.time.events.add(1e3,function(){return z?M():X(M)}),Y.play()},A=function(){var e;L||Pe(),D||(y.body.gravity.y=0,y.body.velocity.y=-100,e=B.add.tween(y.body.velocity).to({y:-t},25,Phaser.Easing.Bounce.In,!0),e.onComplete.add(function(){return y.body.gravity.y=n}),E.play())},ie=function(){var e;B.load.atlasJSONHash("sheet","assets/sheet.png","assets/sheet.json"),e={spritesheet:{leaderboard:["assets/leaderboard.png",52,29],lbPanel:["assets/lbPanel.png",448,320]},image:{tubeTop:["assets/tube1.png"],tubeBottom:["assets/tube2.png"],ground:["assets/path.png"],bg:["assets/bg2.png"],hall:["assets/hall.png"],gameover:["assets/gameover-panel.png"],nameScreen:["assets/name.png"]},audio:{flap:["assets/sfx_wing.mp3"],score:["assets/sfx_point.mp3"],hurt:["assets/sfx_hit.mp3"],fall:["assets/sfx_die.mp3"],swoosh:["assets/sfx_swooshing.mp3"],click:["assets/keyboard_tap.mp3"],hover:["assets/typewriter_key.mp3"]}},Object.keys(e).forEach(function(t){Object.keys(e[t]).forEach(function(n){B.load[t].apply(B.load,[n].concat(e[t][n]))})})},W=function(e){var t,n,o,r,a,l;if(n=0,0===e.length)return n;for(r=e.length,o=a=0,l=r-1;l>=0?l>=a:a>=l;o=l>=0?++a:--a)t=e.charCodeAt(o),n=(n<<5)-n+t,n|=0;return n},k=function(){var e,t,n,i,s,c,h,f,g,b,k,x,P,S,A,I,D,M,L;for(B.add.plugin(Fabrique.Plugins.InputField),c=window.localStorage.getItem("name"),c&&(z=!0,re=c),B.physics.startSystem(Phaser.Physics.ARCADE),g=window.innerWidth/window.innerHeight,(g>1.15||.7>g)&&(document.querySelector("#github").innerHTML=N),document.querySelector("#loading").style.display="none",B.scale.pageAlignVertically=!0,B.smoothed=!1,B.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,B.scale.windowConstraints.bottom="visual",B.scale.setGameSize(u,a),v=B.add.tileSprite(0,0,u,a,"bg"),v.smoothed=!0,v.inputEnabled=!0,v.input.priorityID=0,y=B.add.sprite(0,0),Be=B.add.group(),V=B.add.group(),ee=B.add.group(void 0,void 0,!1,!0,Phaser.Physics.ARCADE),j=B.add.tileSprite(0,r,u,o,"ground"),j.tileScale.setTo(d,d),pe=B.add.text(B.world.width/2,B.world.height/4,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),pe.anchor.setTo(.5,.5),K=B.add.text(B.world.width/2,B.world.height-B.world.height/4,"",{font:'8px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),K.anchor.setTo(.5,.5),F=B.add.text(B.world.width/2,B.world.height/2,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),F.anchor.setTo(.5,.5),F.scale.setTo(d,d),Z=B.add.sprite(B.world.width/2,1.5*B.world.height,"lbPanel",0),Z.anchor.setTo(.5,.5),Z.kill(),P=B.add.text(-170,0,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),P.anchor.setTo(.5,.5),x=B.add.text(20,0,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"left"}),x.anchor.setTo(.5,.5),S=B.add.text(150,0,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"right"}),S.anchor.setTo(.5,.5),M=[P,x,S],A=0,D=M.length;D>A;A++)k=M[A],k.lineSpacing=15;for(Z.addChild(P),Z.addChild(x),Z.addChild(S),s=I=0,L=l-1;L>=0?L>=I:I>=L;s=L>=0?++I:--I)b=p(-120,-105+41*s+10,0),n=B.add.text(0,10,"",{font:'16px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),n.scale.setTo(.5,.5),n.smoothed=!1,n.anchor.setTo(.5,.5),b.addChild(n),b.kill(),Z.addChild(b);e=B.add.button(0-Z.width/2,0-Z.height/2,void 0,function(){return Z.frame=0,we(void 0),console.log("clicked")},this),e.events.onInputUp.add(function(){return T.play()}),e.width=100,e.height=33,t=B.add.button(104-Z.width/2,0-Z.height/2,void 0,function(){return Z.frame=1,me(void 0),console.log("also clicked")},this),t.events.onInputUp.add(function(){return T.play()}),t.width=100,t.height=33,e.bringToTop(),t.bringToTop(),Z.addChild(e),Z.addChild(t),te=B.add.sprite(0,0,"nameScreen",void 0,ee),te.anchor.setTo(.5,.5),te.kill(),ee.x=B.world.width/2,ee.y=1.5*B.world.height,O=B.add.sprite(B.world.width/2,1.5*B.world.height,"gameover"),O.anchor.setTo(.5,.5),O.kill(),Ie=B.add.text(0,O.height/2-20,"Touch to Try Again",{font:'8px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),Ie.anchor.setTo(.5,.5),O.addChild(Ie),i=i=B.add.text(O.width/4-10,-30,"Score\n\nBest",{font:'24px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"left"}),i.anchor.setTo(0,0),O.addChild(i),H=B.add.text(O.width/4-10,0,"",{font:'16px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"left"}),H.anchor.setTo(0,0),O.addChild(H),_=B.add.text(O.width/4-10,68,"",{font:'16px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"left"}),_.anchor.setTo(0,0),O.addChild(_),Q=B.add.button(-100,0,"leaderboard",be,this,2,0,1,0),Q.events.onInputUp.add(function(){return T.play()}),Q.events.onInputOver.add(function(){return q.play()}),Q.scale.setTo(2,2),Q.anchor.setTo(.5,.5),Q.smoothed=!1,O.addChild(Q),f=B.add.text(0,-30,"Enter Name",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),f.anchor.setTo(.5,.5),te.addChild(f),h=B.add.text(0,60,"Press Enter to continue",{font:'8px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),h.anchor.setTo(.5,.5),te.addChild(h),ae=B.add.inputField(-75,10,{font:'16px "Press Start 2P"',fill:"#430",cursorColor:"#430",backgroundColor:"#ffffff",placeHolder:"name",placeHolderColor:"#874",height:30,width:150,type:Fabrique.InputType.text},ee),ae.anchor.setTo(0,.3),ae.bringToTop(),E=B.add.audio("flap"),E.allowMultiple=!0,fe=B.add.audio("score"),Y=B.add.audio("hurt"),C=B.add.audio("fall"),Ee=B.add.audio("swoosh"),q=B.add.audio("hover"),T=B.add.audio("click"),y.kill(),w=[],m()},m=function(){var e,t,n,o,r,a,l,i,d,s,c,h;for(Ee.play(),G=B.add.sprite(B.world.width/2,1.5*B.world.height,"hall"),n=B.add.text(0,-100,"Choose Carefully",{font:'30px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),n.renderable=!0,n.anchor.setTo(.5,.5),G.addChild(n),G.anchor.setTo(.5,.5),t=G.width-50,e=G.height-100,a=h=1;ne>=1?ne>=h:h>=ne;a=ne>=1?++h:--h)a-=1,o=parseInt(a/4),r=a%4,l=-G.width/2+72,i=-G.height/2+120,s=Math.round(t/4*r+l),c=Math.round(e/3*o+i),G.addChild(f(s,c,a+1));return d=B.add.tween(G).to({y:B.world.height/2},800,Phaser.Easing.Back.Out,!0)},f=function(e,t,n){var o,r;return r=B.add.button(e,t,"sheet",function(){return R?void 0:le(n)},this,U[n-1]+"/3",U[n-1]+"/2",U[n-1]+"/1",U[n-1]+"/2"),r.smoothed=!1,r.anchor.setTo(.5,.5),r.animations.add("onHover",[U[n-1]+"/1",U[n-1]+"/2",U[n-1]+"/3",U[n-1]+"/2"],10,!0),r.scale.setTo(2,2),r.smoothed=!1,r.trueY=t,o=B.add.text(0,10,U[n-1],{font:'16px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),o.scale.setTo(.5,.5),o.smoothed=!1,o.anchor.setTo(.5,.5),r.addChild(o),r.setOverSound(T),r.setUpSound(Ee),r.events.onInputOver.add(function(){return r.play("onHover",10,!0,!1),r.doBounce=!0}),r.events.onInputOut.add(function(){return r.animations.stop(),r.doBounce=!1}),r.doBounce=!1,w.push(r),r},le=function(e){var t,n,o,r;for(R=!0,b=e-1,o=0,r=w.length;r>o;o++)t=w[o],t.setOverSound(null),t.setUpSound(null);return y=B.add.sprite(0,0,"sheet",U[e-1]+"/2"),y.scale.setTo(2,2),y.anchor.setTo(.5,.5),B.physics.arcade.enableBody(y),G.bringToTop(),y.animations.add("fly",Phaser.Animation.generateFrameNames(U[e-1]+"/",1,3,"",1),10,!0),y.body.collideWorldBounds=!0,n=B.add.tween(G).to({y:1.5*B.world.height},800,Phaser.Easing.Back.In,!0),n.onComplete.add(function(){var e,n;for(e=0,n=w.length;n>e;e++)t=w[e],t.destroy();return G.destroy()}),y.angle=0,y.revive(),Te=B.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),Te.onDown.add(A),v.events.onInputDown.add(A),v.events.onInputDown.add(function(){}),ce()},ce=function(){Te.onDown.removeAll(),v.events.onInputDown.removeAll(),Te.onDown.add(A),v.events.onInputDown.add(A),L=!1,D=!1,ue=0,pe.setText("Flappy Bird 2.2 Edition"),K.setText("TOUCH TO FLY\nFLAP bird WINGS"),F.renderable=!1,y.smoothed=!1,y.body.allowGravity=!1,y.reset(.3*B.world.width,B.world.height/2),y.angle=0,y.animations.play("fly"),Be.removeAll(),V.removeAll()},Pe=function(){L=!0,B.time.events.remove(De),y.body.allowGravity=!0,y.body.gravity.y=n,De=B.time.events.loop(1/s,xe),pe.setText(ue),K.renderable=!1},Oe=function(){var e,n,o,a;if(L?D?(n=B.add.tween(y).to({angle:90},100,Phaser.Easing.Bounce.Out,!0),y.body.bottom>=r+3&&(y.y=r-13,y.body.velocity.y=0,y.body.allowGravity=!1,y.body.gravity.y=0)):(y.angle=90*(t+y.body.velocity.y)/t-180,y.angle<-30&&(y.angle=-30),y.angle>80?(y.angle=90,y.animations.stop("fly"),y.frame=U[b]+"/2"):y.animations.play("fly"),B.physics.arcade.overlap(y,Be,function(){return ye(),C.play()}),!D&&y.body.bottom>=r&&ye(),B.physics.arcade.overlap(y,V,g)):(y.y=B.world.height/2+8*Math.cos(B.time.now/200),y.angle=0),!R)for(o=0,a=w.length;a>o;o++)e=w[o],e.doBounce?e.y=e.trueY+5*Math.cos(B.time.now/200):e.y=e.trueY;D||(v.tilePosition.x-=B.time.physicsElapsed*c/5),D||(j.tilePosition.x-=B.time.physicsElapsed*c)},X=function(e){var t;return Se(),te.revive(),B.world.bringToTop(ee),t=B.add.tween(ee).to({y:B.world.height/2},800,Phaser.Easing.Back.Out,!0),t.onComplete.add(function(){return ae.addEnterCallback(function(){return Ae(),z=!0,re=ae.value,window.localStorage.setItem("name",re),t=B.add.tween(ee).to({y:1.5*B.world.height},800,Phaser.Easing.Back.In,!0),Ee.play(),t.onComplete.add(function(){return te.kill(),e()})})}),Ee.play()},se=function(){e&&(B.debug.body(y),Be.forEachAlive(function(e){B.debug.body(e)}),V.forEach(function(e){B.debug.body(e)}))},Ce={preload:ie,create:k,update:Oe,render:se},B=new Phaser.Game(u,a,Phaser.CANVAS,oe,Ce,!1,!1),ge=de(32,"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ")},WebFontConfig={google:{families:["Press+Start+2P::latin"]},active:main},function(){var e,t;return t=document.createElement("script"),t.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",t.type="text/javascript",t.async="true",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)}();
var Fabrique;!function(t){!function(t){t[t.text=0]="text",t[t.password=1]="password",t[t.number=2]="number"}(t.InputType||(t.InputType={}));var i=t.InputType,e=function(){function t(t,e,n,s){var o=this;void 0===n&&(n=i.text),void 0===s&&(s=""),this.focusIn=new Phaser.Signal,this.focusOut=new Phaser.Signal,this.id=e,this.type=n,this.game=t,this.element=document.createElement("input"),this.element.id=e,this.element.style.position="absolute",this.element.style.top=(-100).toString()+"px",this.element.style.left=(-100).toString()+"px",this.element.value=this.value,this.element.type=i[n],this.element.addEventListener("focusin",function(){o.focusIn.dispatch()}),this.element.addEventListener("focusout",function(){o.focusOut.dispatch()}),document.body.appendChild(this.element)}return t.prototype.addKeyUpListener=function(t){this.callback=t,document.addEventListener("keyup",this.callback)},t.prototype.removeEventListener=function(){document.removeEventListener("keyup",this.callback)},t.prototype.destroy=function(){document.body.removeChild(this.element)},t.prototype.setMax=function(t,e){if(void 0!==t)if(this.type===i.text||this.type===i.password)this.element.maxLength=parseInt(t,10);else if(this.type===i.number){if(this.element.max=t,void 0===e)return;this.element.min=e}},Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(t){this.element.value=t},enumerable:!0,configurable:!0}),t.prototype.focus=function(){var t=this;if(this.element.focus(),!this.game.device.desktop&&this.game.device.chrome)var i=window.innerWidth,e=window.innerHeight,n=!1,s=setInterval(function(){(i>window.innerWidth||e>window.innerHeight)&&(n=!0),n&&i===window.innerWidth&&e===window.innerHeight&&(t.focusOut.dispatch(),clearInterval(s))},50)},t.prototype.blur=function(){this.element.blur()},Object.defineProperty(t.prototype,"hasSelection",{get:function(){return this.type===i.number?!1:this.element.selectionStart!==this.element.selectionEnd},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"caretStart",{get:function(){return this.element.selectionEnd},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"caretEnd",{get:function(){return this.element.selectionStart},enumerable:!0,configurable:!0}),t.prototype.getCaretPosition=function(){return this.type===i.number?-1:this.element.selectionStart},t.prototype.setCaretPosition=function(t){this.type!==i.number&&this.element.setSelectionRange(t,t)},t}();t.InputElement=e}(Fabrique||(Fabrique={}));var __extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},Fabrique;!function(t){var i=function(i){function e(e,n,s,o){var h=this;switch(void 0===o&&(o={}),i.call(this,e,n,s),this.placeHolder=null,this.box=null,this.focus=!1,this.value="",this.windowScale=1,this.enterPressed=new Phaser.Signal,this.blink=!0,this.cnt=0,this.inputOptions=o,this.inputOptions.width=o.width||150,this.inputOptions.padding=o.padding||0,this.inputOptions.textAlign=o.textAlign||"left",this.inputOptions.type=o.type||t.InputType.text,this.inputOptions.borderRadius=o.borderRadius||0,this.inputOptions.height=o.height||14,this.inputOptions.fillAlpha=void 0===o.fillAlpha?1:o.fillAlpha,this.inputOptions.selectionColor=o.selectionColor||"rgba(179, 212, 253, 0.8)",this.inputOptions.zoom=e.device.desktop?!1:o.zoom||!1,this.box=new t.InputBox(this.game,o),this.setTexture(this.box.generateTexture()),this.textMask=new t.TextMask(this.game,o),this.addChild(this.textMask),this.domElement=new t.InputElement(this.game,"phaser-input-"+(1e4*Math.random()|0).toString(),this.inputOptions.type,this.value),this.domElement.setMax(this.inputOptions.max,this.inputOptions.min),this.selection=new t.SelectionHighlight(this.game,this.inputOptions),this.addChild(this.selection),o.placeHolder&&o.placeHolder.length>0&&(this.placeHolder=new Phaser.Text(e,this.inputOptions.padding,this.inputOptions.padding,o.placeHolder,{font:o.font||"14px Arial",fontWeight:o.fontWeight||"normal",fill:o.placeHolderColor||"#bfbebd"}),this.placeHolder.mask=this.textMask,this.addChild(this.placeHolder)),this.cursor=new Phaser.Text(e,this.inputOptions.padding,this.inputOptions.padding-2,"|",{font:o.font||"14px Arial",fontWeight:o.fontWeight||"normal",fill:o.cursorColor||"#000000"}),this.cursor.visible=!1,this.addChild(this.cursor),this.text=new Phaser.Text(e,this.inputOptions.padding,this.inputOptions.padding,"",{font:o.font||"14px Arial",fontWeight:o.fontWeight||"normal",fill:o.fill||"#000000"}),this.text.mask=this.textMask,this.addChild(this.text),this.offscreenText=new Phaser.Text(e,this.inputOptions.padding,this.inputOptions.padding,"",{font:o.font||"14px Arial",fontWeight:o.fontWeight||"normal",fill:o.fill||"#000000"}),this.inputOptions.textAlign){case"left":this.text.anchor.set(0,0),this.cursor.x=this.inputOptions.padding+this.getCaretPosition();break;case"center":this.text.anchor.set(.5,0),this.text.x+=this.inputOptions.width/2,this.cursor.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2+this.getCaretPosition();break;case"right":this.text.anchor.set(1,0),this.text.x+=this.inputOptions.width,this.cursor.x=this.inputOptions.padding+this.inputOptions.width}this.inputEnabled=!0,this.input.useHandCursor=!0,this.game.input.onDown.add(this.checkDown,this),this.domElement.focusOut.add(function(){t.Plugins.InputField.KeyboardOpen&&(h.endFocus(),h.inputOptions.zoom&&h.zoomOut())})}return __extends(e,i),e.prototype.checkDown=function(i){if(this.input.checkPointerOver(i)){if(this.focus)return void this.setCaretOnclick(i);null!==this.placeHolder&&(this.placeHolder.visible=!1),this.inputOptions.zoom&&!t.Plugins.InputField.Zoomed&&this.zoomIn(),this.startFocus()}else this.focus===!0&&(this.endFocus(),this.inputOptions.zoom&&this.zoomOut())},e.prototype.update=function(){if(this.focus){if(30!==this.cnt)return this.cnt++;this.cursor.visible=this.blink,this.blink=!this.blink,this.cnt=0}},e.prototype.endFocus=function(){var i=this;this.domElement.removeEventListener(),this.focus=!1,0===this.value.length&&null!==this.placeHolder&&(this.placeHolder.visible=!0),this.cursor.visible=!1,this.game.device.desktop?setTimeout(function(){i.domElement.blur()},0):this.domElement.blur(),this.game.device.desktop||(t.Plugins.InputField.KeyboardOpen=!1,t.Plugins.InputField.onKeyboardClose.dispatch())},e.prototype.addEnterCallback=function(t){this.enterPressed.add(t)},e.prototype.startFocus=function(){var i=this;this.focus=!0,this.domElement.addKeyUpListener(this.keyListener.bind(this)),this.game.device.desktop?setTimeout(function(){i.domElement.focus()},0):this.domElement.focus(),this.game.device.desktop||(t.Plugins.InputField.KeyboardOpen=!0,t.Plugins.InputField.onKeyboardOpen.dispatch())},e.prototype.updateText=function(){var i="";if(this.inputOptions.type===t.InputType.password)for(var e=0;e<this.value.length;e++)i+="*";else if(this.inputOptions.type===t.InputType.number){var n=parseInt(this.value);i=n<parseInt(this.inputOptions.min)?this.inputOptions.min:n>parseInt(this.inputOptions.max)?this.inputOptions.max:this.value}else i=this.value;if(this.text.setText(i),this.text.width>this.inputOptions.width)this.text.anchor.x=1,this.text.x=this.inputOptions.padding+this.inputOptions.width;else switch(this.inputOptions.textAlign){case"left":this.text.anchor.set(0,0),this.text.x=this.inputOptions.padding;break;case"center":this.text.anchor.set(.5,0),this.text.x=this.inputOptions.padding+this.inputOptions.width/2;break;case"right":this.text.anchor.set(1,0),this.text.x=this.inputOptions.padding+this.inputOptions.width}},e.prototype.updateCursor=function(){if(this.text.width>this.inputOptions.width||"right"===this.inputOptions.textAlign)this.cursor.x=this.inputOptions.padding+this.inputOptions.width;else switch(this.inputOptions.textAlign){case"left":this.cursor.x=this.inputOptions.padding+this.getCaretPosition();break;case"center":this.cursor.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2+this.getCaretPosition()}},e.prototype.getCaretPosition=function(){var i=this.domElement.getCaretPosition();if(-1===i)return this.text.width;var e=this.value;if(this.inputOptions.type===t.InputType.password){e="";for(var n=0;n<this.value.length;n++)e+="*"}return this.offscreenText.setText(e.slice(0,i)),this.offscreenText.width},e.prototype.setCaretOnclick=function(t){var i=this.text.toLocal(new PIXI.Point(t.x,t.y),this.game.world).x;this.inputOptions.textAlign&&"center"===this.inputOptions.textAlign&&(i+=this.text.width/2);for(var e=this.text.width/this.value.length,n=0,s=0;s<this.value.length;s++)if(i>=s*e&&(s+1)*e>=i){n=s;break}i>(this.value.length-1)*e&&(n=this.value.length),this.startFocus(),this.domElement.setCaretPosition(n),this.updateCursor()},e.prototype.updateSelection=function(){if(this.domElement.hasSelection){var i=this.value;if(this.inputOptions.type===t.InputType.password){i="";for(var e=0;e<this.value.length;e++)i+="*"}switch(i=i.substring(this.domElement.caretStart,this.domElement.caretEnd),this.offscreenText.setText(i),this.selection.updateSelection(this.offscreenText.getBounds()),this.inputOptions.textAlign){case"left":this.selection.x=this.inputOptions.padding;break;case"center":this.selection.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2}}else this.selection.clear()},e.prototype.zoomIn=function(){if(!t.Plugins.InputField.Zoomed){var i=this.getBounds();window.innerHeight>window.innerWidth?this.windowScale=this.game.width/(1.5*i.width):this.windowScale=this.game.width/2/(1.5*i.width);var e=(this.game.width-1.5*i.width)/2/this.windowScale;this.game.world.scale.set(this.game.world.scale.x*this.windowScale,this.game.world.scale.y*this.windowScale),this.game.world.pivot.set(i.x-e,i.y-2*this.inputOptions.padding),t.Plugins.InputField.Zoomed=!0}},e.prototype.zoomOut=function(){t.Plugins.InputField.Zoomed&&(this.game.world.scale.set(this.game.world.scale.x/this.windowScale,this.game.world.scale.y/this.windowScale),this.game.world.pivot.set(0,0),t.Plugins.InputField.Zoomed=!1)},e.prototype.keyListener=function(t){return this.value=this.domElement.value,13===t.keyCode?(this.endFocus(),void this.enterPressed.dispatch()):(this.updateText(),this.updateCursor(),void this.updateSelection())},e.prototype.destroy=function(){this.domElement.destroy(),i.prototype.destroy.call(this)},e.prototype.resetText=function(){this.setText()},e.prototype.setText=function(t){void 0===t&&(t=""),t.length>0?this.placeHolder.visible=!1:this.placeHolder.visible=!0,this.value=t,this.domElement.value=this.value,this.updateText(),this.updateCursor(),this.endFocus()},e}(Phaser.Sprite);t.InputField=i}(Fabrique||(Fabrique={}));var Fabrique;!function(t){var i=function(t){function i(i,e){t.call(this,i,0,0);var n=e.backgroundColor?parseInt(e.backgroundColor.slice(1),16):16777215,s=e.borderRadius||0,o=e.borderColor?parseInt(e.borderColor.slice(1),16):9803157,h=e.fillAlpha,r=e.height;e.font&&(r=Math.max(parseInt(e.font.substr(0,e.font.indexOf("px")),10),r)),r=2*e.padding+r;var p=e.width;p=2*e.padding+p,this.beginFill(n,h).lineStyle(e.borderWidth||1,o,h),s>0?this.drawRoundedRect(0,0,p,r,s):this.drawRect(0,0,p,r)}return __extends(i,t),i}(Phaser.Graphics);t.InputBox=i}(Fabrique||(Fabrique={}));var Fabrique;!function(t){var i=function(t){function i(i,e){t.call(this,i,e.padding,e.padding),this.inputOptions=e}return __extends(i,t),i.prototype.updateSelection=function(t){var e=Phaser.Color.webToColor(this.inputOptions.selectionColor);this.clear(),this.beginFill(i.rgb2hex(e),e.a),this.drawRect(t.x,t.y,t.width,t.height-this.inputOptions.padding)},i.rgb2hex=function(t){return parseInt(("0"+t.r.toString(16)).slice(-2)+("0"+t.g.toString(16)).slice(-2)+("0"+t.b.toString(16)).slice(-2),16)},i}(Phaser.Graphics);t.SelectionHighlight=i}(Fabrique||(Fabrique={}));var Fabrique;!function(t){var i=function(t){function i(i,e){t.call(this,i,e.padding,e.padding);var n=e.borderRadius,s=e.height;e.font&&(s=Math.max(parseInt(e.font.substr(0,e.font.indexOf("px")),10),s));var o=e.width;this.beginFill(0),n>0?this.drawRoundedRect(0,0,o,s,n):this.drawRect(0,0,o,s)}return __extends(i,t),i}(Phaser.Graphics);t.TextMask=i}(Fabrique||(Fabrique={}));var Fabrique;!function(t){var i;!function(i){var e=function(i){function e(t,e){i.call(this,t,e),this.addInputFieldFactory()}return __extends(e,i),e.prototype.addInputFieldFactory=function(){Phaser.GameObjectFactory.prototype.inputField=function(i,e,n,s){void 0===s&&(s=this.world);var o=new t.InputField(this.game,i,e,n);return s.add(o)},Phaser.GameObjectCreator.prototype.inputField=function(i,e,n){return new t.InputField(this.game,i,e,n)}},e.Zoomed=!1,e.KeyboardOpen=!1,e.onKeyboardOpen=new Phaser.Signal,e.onKeyboardClose=new Phaser.Signal,e}(Phaser.Plugin);i.InputField=e}(i=t.Plugins||(t.Plugins={}))}(Fabrique||(Fabrique={}));