var WebFontConfig,main;main=function(){var e,t,n,o,r,a,l,d,s,i,c,h,u,f,p,g,y,v,w,m,b,k,T,x,P,S,C,A,E,B,I,D,M,O,H,_,F,N,L,j,G,R,W,q,U,Y,K,V,z,J,Z,Q,X,ee,te,ne,oe,re,ae,le,de,se,ie,ce,he,ue,fe,pe,ge,ye,ve,we,me,be,ke,Te,xe,Pe,Se,Ce,Ae,Ee,Be,Ie;h="flappy",e=!1,c=160,n=1100,t=320,i=1/1200,d=100,s=1,l=6,a=384,u=500,o=64,r=a-o,oe=document.querySelector("#screen"),N=void 0,D=void 0,S=[],P=[],x=[],J=[{name:"Arpit",score:"58",hall:"AZ"},{name:"Apoorv",score:"2",hall:"NH"},{name:"Vikrant",score:"1",hall:"RP"},{name:"Arkanath",score:"100",hall:"MS"}],W=["AZ","MT","RP","SN","NH","PT","RK","LLR","MS","LBS","MMM","HJB"],b=null,z=!1,R=!1,y=null,Ee=null,V=null,v=null,j=null,G=null,M=null,te=null,Z=null,ee=null,ge=null,re=null,ue=null,pe=null,K=null,F=null,Ae=null,H=null,_=null,ae=null,E=null,fe=null,Y=null,C=null,Ce=null,U=null,k=null,Be=null,me=null,ne=12,w=null,Q=null,L='<iframe src="http://ghbtns.com/github-btn.html?user=korroktheslavemaster&repo=flappy-kgp&type=watch&count=true&size=large"\nallowtransparency="true" frameborder="0" scrolling="0" width="150" height="30"></iframe>',B=Math.floor,se=function(e,t){var n,o,r;for(o="",n=r=e;1>=e?1>=r:r>=1;n=1>=e?++r:--r)o+=t[Math.floor(Math.random()*t.length)];return o},be=function(e,t){var n,o,r;return n=null,o=t?"tubeTop":"tubeBottom",r=B(t?e-d/2-320:e+d/2),S.length>0&&"tubeTop"===o?(n=S.pop().revive(),n.reset(I.world.width,r)):P.length>0&&"tubeBottom"===o?(n=P.pop().revive(),n.reset(I.world.width,r)):(n=Ee.create(I.world.width,r,o),I.physics.arcade.enableBody(n),n.body.allowGravity=!1),n.body.velocity.x=-c,n},ke=function(){var e,t,n,o;Ee.forEachAlive(function(e){e.x+e.width<I.world.bounds.left&&("tubeTop"===e.key&&S.push(e.kill()),"tubeBottom"===e.key&&P.push(e.kill()))}),V.forEachAlive(function(e){e.x+e.width<I.world.bounds.left&&x.push(e.kill())}),o=I.world.height/2+(Math.random()-.5)*I.world.height*.2,e=be(o),n=be(o,!0),x.length>0?t=x.pop().revive().reset(n.x+n.width/2,0):(t=V.create(n.x+n.width/2,0),I.physics.arcade.enableBody(t),t.width=2,t.height=I.world.height,t.body.allowGravity=!1),t.body.velocity.x=-c},g=function(e,t){V.remove(t),ue+=1,pe.setText(ue),fe.play()},he=function(){for(J.sort(function(e,t){return parseInt(e.score)<parseInt(t.score)});J.length<l;)J.push({name:"---",score:"-1",hall:"DUMMY2"});return J},ye=function(){var e;return e={score:ue,name:re,hall:W[b],key:ge,token:q(ue+ge+h+ue)},$.ajax({type:"POST",data:e,dataType:"text",url:"/sendScore",success:function(e){},error:function(){}})},we=function(){var e,t;return e=ye(),Q.input.enabled=!1,M.alive?(t=I.add.tween(M).to({y:1.5*I.world.height},800,Phaser.Easing.Back.In,!0),Ce.play(),me.onDown.removeAll(),y.events.onInputDown.removeAll(),t.onComplete.add(function(){var n,o,r,a,l,d,s;for(M.kill(),Z.revive(),Z.bringToTop(),t=I.add.tween(Z).to({y:I.world.height/2},800,Phaser.Easing.Back.Out,!0),r="",o="",a="",Z.children[1].setText("Loading.."),Z.children[2].setText(""),Z.children[0].setText(""),l=d=3,s=Z.children.length-1;s>=3?s>=d:d>=s;l=s>=3?++d:--d)Z.children[l].kill();return n=function(){var e,t,n,l;for(t=n=0,l=J.length-1;l>=0?l>=n:n>=l;t=l>=0?++n:--n)J[t].score<0?(r+="\n-",o+="\n---",a+="\n---",Z.children[3+t].kill()):(r+="\n"+(t+1),o+="\n"+J[t].name,a+="\n"+J[t].score,e=Z.children[3+t],e.revive(),e.frameName=J[t].hall+"/2",e.children[0].setText(J[t].hall));return Z.children[0].setText(r),Z.children[1].setText(o),Z.children[2].setText(a)},$.when(e).done(function(e){return $.ajax({type:"GET",url:"/getLeaderboard",success:function(e){return J=e,he(),n()},error:function(){return J=[],he(),n()}})}),t.onComplete.add(function(){var e;return e=function(){return Z.alive?(t=I.add.tween(Z).to({y:1.5*I.world.height},800,Phaser.Easing.Back.In,!0),Ce.play(),me.onDown.removeAll(),y.events.onInputDown.removeAll(),t.onComplete.add(function(){return Z.kill(),ce()})):ce()},y.events.onInputDown.addOnce(e),me.onDown.addOnce(e)})})):void 0},p=function(e,t,n){var o;return o=I.add.sprite(e,t,"sheet",W[n]+"/2"),o.scale.setTo(2,2),o.smoothed=!1,o.anchor.setTo(.5,.5),o},xe=function(){return y.inputEnabled=!1,me.onDown.removeAll(),ae.startFocus(),ae.focus=!0,ae.placeHolder.visible=!1},Se=function(){return ae.endFocus(),ae.focus=!1,y.inputEnabled=!0},O=function(){var e;return me.onDown.removeAll(),y.events.onInputDown.removeAll(),M.revive(),Q.input.enabled=!1,M.bringToTop(),e=I.add.tween(M).to({y:I.world.height/2},800,Phaser.Easing.Back.Out,!0),e.onComplete.add(function(){var t;return Q.input.enabled=!0,t=function(){return ye(),Q.input.enabled=!1,M.alive?(e=I.add.tween(M).to({y:1.5*I.world.height},800,Phaser.Easing.Back.In,!0),Ce.play(),me.onDown.removeAll(),y.events.onInputDown.removeAll(),e.onComplete.add(function(){return M.kill(),ce()})):ce()},y.events.onInputDown.addOnce(t),me.onDown.addOnce(t)}),Ce.play()},ve=function(){var e;D=!0,v.body.velocity.y>0&&(v.body.velocity.y=100),v.animations.stop(),v.frame=W[b]+"/2",e=window.localStorage.getItem("hiscore"),e=e?e:ue,e=ue>parseInt(e,10)?ue:e,window.localStorage.setItem("hiscore",e),H.setText(ue),_.setText(e),Ee.forEachAlive(function(e){e.body.velocity.x=0}),V.forEach(function(e){e.body.velocity.x=0}),I.time.events.remove(Be),I.time.events.add(1e3,function(){return z?O():X(O)}),Y.play()},A=function(){var e;N||Te(),D||(v.body.gravity.y=0,v.body.velocity.y=-100,e=I.add.tween(v.body.velocity).to({y:-t},25,Phaser.Easing.Bounce.In,!0),e.onComplete.add(function(){return v.body.gravity.y=n}),E.play())},de=function(){var e;I.load.atlasJSONHash("sheet","assets/sheet.png","assets/sheet.json"),e={spritesheet:{leaderboard:["assets/leaderboard.png",52,29]},image:{tubeTop:["assets/tube1.png"],tubeBottom:["assets/tube2.png"],ground:["assets/path.png"],bg:["assets/bg2.png"],hall:["assets/hall.png"],gameover:["assets/gameover-panel.png"],lbPanel:["assets/lbPanel.png"],nameScreen:["assets/name.png"]},audio:{flap:["assets/sfx_wing.mp3"],score:["assets/sfx_point.mp3"],hurt:["assets/sfx_hit.mp3"],fall:["assets/sfx_die.mp3"],swoosh:["assets/sfx_swooshing.mp3"],click:["assets/keyboard_tap.mp3"],hover:["assets/typewriter_key.mp3"]}},Object.keys(e).forEach(function(t){Object.keys(e[t]).forEach(function(n){I.load[t].apply(I.load,[n].concat(e[t][n]))})})},q=function(e){var t,n,o,r,a,l;if(n=0,0===e.length)return n;for(r=e.length,o=a=0,l=r-1;l>=0?l>=a:a>=l;o=l>=0?++a:--a)t=e.charCodeAt(o),n=(n<<5)-n+t,n|=0;return n},T=function(){var e,t,n,d,i,c,h,f,g,b,T,x,P,S,A,B;for(I.add.plugin(Fabrique.Plugins.InputField),I.physics.startSystem(Phaser.Physics.ARCADE),c=window.innerWidth/window.innerHeight,(c>1.15||.7>c)&&(document.querySelector("#github").innerHTML=L),document.querySelector("#loading").style.display="none",I.scale.pageAlignVertically=!0,I.smoothed=!1,I.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,I.scale.windowConstraints.bottom="visual",I.scale.setGameSize(u,a),y=I.add.tileSprite(0,0,u,a,"bg"),y.smoothed=!0,y.inputEnabled=!0,y.input.priorityID=0,v=I.add.sprite(0,0),Ee=I.add.group(),V=I.add.group(),ee=I.add.group(void 0,void 0,!1,!0,Phaser.Physics.ARCADE),j=I.add.tileSprite(0,r,u,o,"ground"),j.tileScale.setTo(s,s),pe=I.add.text(I.world.width/2,I.world.height/4,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),pe.anchor.setTo(.5,.5),K=I.add.text(I.world.width/2,I.world.height-I.world.height/4,"",{font:'8px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),K.anchor.setTo(.5,.5),F=I.add.text(I.world.width/2,I.world.height/2,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),F.anchor.setTo(.5,.5),F.scale.setTo(s,s),Z=I.add.sprite(I.world.width/2,1.5*I.world.height,"lbPanel"),Z.anchor.setTo(.5,.5),Z.kill(),b=I.add.text(-170,-10,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),b.anchor.setTo(.5,.5),g=I.add.text(20,-10,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"left"}),g.anchor.setTo(.5,.5),T=I.add.text(150,-10,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"right"}),T.anchor.setTo(.5,.5),A=[b,g,T],x=0,S=A.length;S>x;x++)f=A[x],f.lineSpacing=15;for(Z.addChild(b),Z.addChild(g),Z.addChild(T),n=P=0,B=l-1;B>=0?B>=P:P>=B;n=B>=0?++P:--P)h=p(-120,-105+41*n,0),e=I.add.text(0,10,"",{font:'16px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),e.scale.setTo(.5,.5),e.smoothed=!1,e.anchor.setTo(.5,.5),h.addChild(e),h.kill(),Z.addChild(h);te=I.add.sprite(0,0,"nameScreen",void 0,ee),te.anchor.setTo(.5,.5),te.kill(),ee.x=I.world.width/2,ee.y=1.5*I.world.height,M=I.add.sprite(I.world.width/2,1.5*I.world.height,"gameover"),M.anchor.setTo(.5,.5),M.kill(),Ae=I.add.text(0,M.height/2-20,"Touch to Try Again",{font:'8px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),Ae.anchor.setTo(.5,.5),M.addChild(Ae),t=t=I.add.text(M.width/4-10,-30,"Score\n\nBest",{font:'24px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"left"}),t.anchor.setTo(0,0),M.addChild(t),H=I.add.text(M.width/4-10,0,"",{font:'16px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"left"}),H.anchor.setTo(0,0),M.addChild(H),_=I.add.text(M.width/4-10,68,"",{font:'16px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"left"}),_.anchor.setTo(0,0),M.addChild(_),Q=I.add.button(-100,0,"leaderboard",we,this,0,0,1),Q.events.onInputUp.add(function(){return k.play()}),Q.scale.setTo(2,2),Q.anchor.setTo(.5,.5),Q.smoothed=!1,M.addChild(Q),i=I.add.text(0,-30,"Enter Name",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),i.anchor.setTo(.5,.5),te.addChild(i),d=I.add.text(0,60,"Press Enter to continue",{font:'8px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),d.anchor.setTo(.5,.5),te.addChild(d),ae=I.add.inputField(-75,10,{font:'16px "Press Start 2P"',fill:"#430",cursorColor:"#430",backgroundColor:"#ffffff",placeHolder:"name",placeHolderColor:"#874",height:30,width:150,type:Fabrique.InputType.text},ee),ae.anchor.setTo(0,.3),ae.bringToTop(),E=I.add.audio("flap"),E.allowMultiple=!0,fe=I.add.audio("score"),Y=I.add.audio("hurt"),C=I.add.audio("fall"),Ce=I.add.audio("swoosh"),U=I.add.audio("hover"),k=I.add.audio("click"),v.kill(),w=[],m()},m=function(){var e,t,n,o,r,a,l,d,s,i,c,h;for(Ce.play(),G=I.add.sprite(I.world.width/2,1.5*I.world.height,"hall"),n=I.add.text(0,-100,"Choose Carefully",{font:'30px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),n.renderable=!0,n.anchor.setTo(.5,.5),G.addChild(n),G.anchor.setTo(.5,.5),t=G.width-50,e=G.height-100,a=h=1;ne>=1?ne>=h:h>=ne;a=ne>=1?++h:--h)a-=1,o=parseInt(a/4),r=a%4,l=-G.width/2+72,d=-G.height/2+120,i=Math.round(t/4*r+l),c=Math.round(e/3*o+d),G.addChild(f(i,c,a+1));return s=I.add.tween(G).to({y:I.world.height/2},800,Phaser.Easing.Back.Out,!0)},f=function(e,t,n){var o,r;return r=I.add.button(e,t,"sheet",function(){return R?void 0:le(n)},this,W[n-1]+"/3",W[n-1]+"/2",W[n-1]+"/1",W[n-1]+"/2"),r.smoothed=!1,r.anchor.setTo(.5,.5),r.animations.add("onHover",[W[n-1]+"/1",W[n-1]+"/2",W[n-1]+"/3",W[n-1]+"/2"],10,!0),r.scale.setTo(2,2),r.smoothed=!1,r.trueY=t,o=I.add.text(0,10,W[n-1],{font:'16px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),o.scale.setTo(.5,.5),o.smoothed=!1,o.anchor.setTo(.5,.5),r.addChild(o),r.setOverSound(k),r.setUpSound(Ce),r.events.onInputOver.add(function(){return r.play("onHover",10,!0,!1),r.doBounce=!0}),r.events.onInputOut.add(function(){return r.animations.stop(),r.doBounce=!1}),r.doBounce=!1,w.push(r),r},le=function(e){var t,n,o,r;for(R=!0,b=e-1,o=0,r=w.length;r>o;o++)t=w[o],t.setOverSound(null),t.setUpSound(null);return v=I.add.sprite(0,0,"sheet",W[e-1]+"/2"),v.scale.setTo(2,2),v.anchor.setTo(.5,.5),I.physics.arcade.enableBody(v),G.bringToTop(),v.animations.add("fly",Phaser.Animation.generateFrameNames(W[e-1]+"/",1,3,"",1),10,!0),v.body.collideWorldBounds=!0,n=I.add.tween(G).to({y:1.5*I.world.height},800,Phaser.Easing.Back.In,!0),n.onComplete.add(function(){var e,n;for(e=0,n=w.length;n>e;e++)t=w[e],t.destroy();return G.destroy()}),v.angle=0,v.revive(),me=I.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),me.onDown.add(A),y.events.onInputDown.add(A),y.events.onInputDown.add(function(){}),ce()},ce=function(){me.onDown.removeAll(),y.events.onInputDown.removeAll(),me.onDown.add(A),y.events.onInputDown.add(A),N=!1,D=!1,ue=0,pe.setText("Flappy Bird 2.2 Edition"),K.setText("TOUCH TO FLY\nFLAP bird WINGS"),F.renderable=!1,v.smoothed=!1,v.body.allowGravity=!1,v.reset(.3*I.world.width,I.world.height/2),v.angle=0,v.animations.play("fly"),Ee.removeAll(),V.removeAll()},Te=function(){N=!0,I.time.events.remove(Be),v.body.allowGravity=!0,v.body.gravity.y=n,Be=I.time.events.loop(1/i,ke),pe.setText(ue),K.renderable=!1},Ie=function(){var e,n,o,a;if(N?D?(n=I.add.tween(v).to({angle:90},100,Phaser.Easing.Bounce.Out,!0),v.body.bottom>=r+3&&(v.y=r-13,v.body.velocity.y=0,v.body.allowGravity=!1,v.body.gravity.y=0)):(v.angle=90*(t+v.body.velocity.y)/t-180,v.angle<-30&&(v.angle=-30),v.angle>80?(v.angle=90,v.animations.stop("fly"),v.frame=W[b]+"/2"):v.animations.play("fly"),I.physics.arcade.overlap(v,Ee,function(){return ve(),C.play()}),!D&&v.body.bottom>=r&&ve(),I.physics.arcade.overlap(v,V,g)):(v.y=I.world.height/2+8*Math.cos(I.time.now/200),v.angle=0),!R)for(o=0,a=w.length;a>o;o++)e=w[o],e.doBounce?e.y=e.trueY+5*Math.cos(I.time.now/200):e.y=e.trueY;D||(y.tilePosition.x-=I.time.physicsElapsed*c/5),D||(j.tilePosition.x-=I.time.physicsElapsed*c)},X=function(e){var t;return xe(),te.revive(),I.world.bringToTop(ee),t=I.add.tween(ee).to({y:I.world.height/2},800,Phaser.Easing.Back.Out,!0),t.onComplete.add(function(){return ae.addEnterCallback(function(){return Se(),z=!0,re=ae.value,t=I.add.tween(ee).to({y:1.5*I.world.height},800,Phaser.Easing.Back.In,!0),Ce.play(),t.onComplete.add(function(){return te.kill(),e()})})}),Ce.play()},ie=function(){e&&(I.debug.body(v),Ee.forEachAlive(function(e){I.debug.body(e)}),V.forEach(function(e){I.debug.body(e)}))},Pe={preload:de,create:T,update:Ie,render:ie},I=new Phaser.Game(u,a,Phaser.CANVAS,oe,Pe,!1,!1),ge=se(32,"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ")},WebFontConfig={google:{families:["Press+Start+2P::latin"]},active:main},function(){var e,t;return t=document.createElement("script"),t.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",t.type="text/javascript",t.async="true",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)}();
var Fabrique;!function(t){!function(t){t[t.text=0]="text",t[t.password=1]="password",t[t.number=2]="number"}(t.InputType||(t.InputType={}));var i=t.InputType,e=function(){function t(t,e,n,s){var o=this;void 0===n&&(n=i.text),void 0===s&&(s=""),this.focusIn=new Phaser.Signal,this.focusOut=new Phaser.Signal,this.id=e,this.type=n,this.game=t,this.element=document.createElement("input"),this.element.id=e,this.element.style.position="absolute",this.element.style.top=(-100).toString()+"px",this.element.style.left=(-100).toString()+"px",this.element.value=this.value,this.element.type=i[n],this.element.addEventListener("focusin",function(){o.focusIn.dispatch()}),this.element.addEventListener("focusout",function(){o.focusOut.dispatch()}),document.body.appendChild(this.element)}return t.prototype.addKeyUpListener=function(t){this.callback=t,document.addEventListener("keyup",this.callback)},t.prototype.removeEventListener=function(){document.removeEventListener("keyup",this.callback)},t.prototype.destroy=function(){document.body.removeChild(this.element)},t.prototype.setMax=function(t,e){if(void 0!==t)if(this.type===i.text||this.type===i.password)this.element.maxLength=parseInt(t,10);else if(this.type===i.number){if(this.element.max=t,void 0===e)return;this.element.min=e}},Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(t){this.element.value=t},enumerable:!0,configurable:!0}),t.prototype.focus=function(){var t=this;if(this.element.focus(),!this.game.device.desktop&&this.game.device.chrome)var i=window.innerWidth,e=window.innerHeight,n=!1,s=setInterval(function(){(i>window.innerWidth||e>window.innerHeight)&&(n=!0),n&&i===window.innerWidth&&e===window.innerHeight&&(t.focusOut.dispatch(),clearInterval(s))},50)},t.prototype.blur=function(){this.element.blur()},Object.defineProperty(t.prototype,"hasSelection",{get:function(){return this.type===i.number?!1:this.element.selectionStart!==this.element.selectionEnd},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"caretStart",{get:function(){return this.element.selectionEnd},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"caretEnd",{get:function(){return this.element.selectionStart},enumerable:!0,configurable:!0}),t.prototype.getCaretPosition=function(){return this.type===i.number?-1:this.element.selectionStart},t.prototype.setCaretPosition=function(t){this.type!==i.number&&this.element.setSelectionRange(t,t)},t}();t.InputElement=e}(Fabrique||(Fabrique={}));var __extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},Fabrique;!function(t){var i=function(i){function e(e,n,s,o){var h=this;switch(void 0===o&&(o={}),i.call(this,e,n,s),this.placeHolder=null,this.box=null,this.focus=!1,this.value="",this.windowScale=1,this.enterPressed=new Phaser.Signal,this.blink=!0,this.cnt=0,this.inputOptions=o,this.inputOptions.width=o.width||150,this.inputOptions.padding=o.padding||0,this.inputOptions.textAlign=o.textAlign||"left",this.inputOptions.type=o.type||t.InputType.text,this.inputOptions.borderRadius=o.borderRadius||0,this.inputOptions.height=o.height||14,this.inputOptions.fillAlpha=void 0===o.fillAlpha?1:o.fillAlpha,this.inputOptions.selectionColor=o.selectionColor||"rgba(179, 212, 253, 0.8)",this.inputOptions.zoom=e.device.desktop?!1:o.zoom||!1,this.box=new t.InputBox(this.game,o),this.setTexture(this.box.generateTexture()),this.textMask=new t.TextMask(this.game,o),this.addChild(this.textMask),this.domElement=new t.InputElement(this.game,"phaser-input-"+(1e4*Math.random()|0).toString(),this.inputOptions.type,this.value),this.domElement.setMax(this.inputOptions.max,this.inputOptions.min),this.selection=new t.SelectionHighlight(this.game,this.inputOptions),this.addChild(this.selection),o.placeHolder&&o.placeHolder.length>0&&(this.placeHolder=new Phaser.Text(e,this.inputOptions.padding,this.inputOptions.padding,o.placeHolder,{font:o.font||"14px Arial",fontWeight:o.fontWeight||"normal",fill:o.placeHolderColor||"#bfbebd"}),this.placeHolder.mask=this.textMask,this.addChild(this.placeHolder)),this.cursor=new Phaser.Text(e,this.inputOptions.padding,this.inputOptions.padding-2,"|",{font:o.font||"14px Arial",fontWeight:o.fontWeight||"normal",fill:o.cursorColor||"#000000"}),this.cursor.visible=!1,this.addChild(this.cursor),this.text=new Phaser.Text(e,this.inputOptions.padding,this.inputOptions.padding,"",{font:o.font||"14px Arial",fontWeight:o.fontWeight||"normal",fill:o.fill||"#000000"}),this.text.mask=this.textMask,this.addChild(this.text),this.offscreenText=new Phaser.Text(e,this.inputOptions.padding,this.inputOptions.padding,"",{font:o.font||"14px Arial",fontWeight:o.fontWeight||"normal",fill:o.fill||"#000000"}),this.inputOptions.textAlign){case"left":this.text.anchor.set(0,0),this.cursor.x=this.inputOptions.padding+this.getCaretPosition();break;case"center":this.text.anchor.set(.5,0),this.text.x+=this.inputOptions.width/2,this.cursor.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2+this.getCaretPosition();break;case"right":this.text.anchor.set(1,0),this.text.x+=this.inputOptions.width,this.cursor.x=this.inputOptions.padding+this.inputOptions.width}this.inputEnabled=!0,this.input.useHandCursor=!0,this.game.input.onDown.add(this.checkDown,this),this.domElement.focusOut.add(function(){t.Plugins.InputField.KeyboardOpen&&(h.endFocus(),h.inputOptions.zoom&&h.zoomOut())})}return __extends(e,i),e.prototype.checkDown=function(i){if(this.input.checkPointerOver(i)){if(this.focus)return void this.setCaretOnclick(i);null!==this.placeHolder&&(this.placeHolder.visible=!1),this.inputOptions.zoom&&!t.Plugins.InputField.Zoomed&&this.zoomIn(),this.startFocus()}else this.focus===!0&&(this.endFocus(),this.inputOptions.zoom&&this.zoomOut())},e.prototype.update=function(){if(this.focus){if(30!==this.cnt)return this.cnt++;this.cursor.visible=this.blink,this.blink=!this.blink,this.cnt=0}},e.prototype.endFocus=function(){var i=this;this.domElement.removeEventListener(),this.focus=!1,0===this.value.length&&null!==this.placeHolder&&(this.placeHolder.visible=!0),this.cursor.visible=!1,this.game.device.desktop?setTimeout(function(){i.domElement.blur()},0):this.domElement.blur(),this.game.device.desktop||(t.Plugins.InputField.KeyboardOpen=!1,t.Plugins.InputField.onKeyboardClose.dispatch())},e.prototype.addEnterCallback=function(t){this.enterPressed.add(t)},e.prototype.startFocus=function(){var i=this;this.focus=!0,this.domElement.addKeyUpListener(this.keyListener.bind(this)),this.game.device.desktop?setTimeout(function(){i.domElement.focus()},0):this.domElement.focus(),this.game.device.desktop||(t.Plugins.InputField.KeyboardOpen=!0,t.Plugins.InputField.onKeyboardOpen.dispatch())},e.prototype.updateText=function(){var i="";if(this.inputOptions.type===t.InputType.password)for(var e=0;e<this.value.length;e++)i+="*";else if(this.inputOptions.type===t.InputType.number){var n=parseInt(this.value);i=n<parseInt(this.inputOptions.min)?this.inputOptions.min:n>parseInt(this.inputOptions.max)?this.inputOptions.max:this.value}else i=this.value;if(this.text.setText(i),this.text.width>this.inputOptions.width)this.text.anchor.x=1,this.text.x=this.inputOptions.padding+this.inputOptions.width;else switch(this.inputOptions.textAlign){case"left":this.text.anchor.set(0,0),this.text.x=this.inputOptions.padding;break;case"center":this.text.anchor.set(.5,0),this.text.x=this.inputOptions.padding+this.inputOptions.width/2;break;case"right":this.text.anchor.set(1,0),this.text.x=this.inputOptions.padding+this.inputOptions.width}},e.prototype.updateCursor=function(){if(this.text.width>this.inputOptions.width||"right"===this.inputOptions.textAlign)this.cursor.x=this.inputOptions.padding+this.inputOptions.width;else switch(this.inputOptions.textAlign){case"left":this.cursor.x=this.inputOptions.padding+this.getCaretPosition();break;case"center":this.cursor.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2+this.getCaretPosition()}},e.prototype.getCaretPosition=function(){var i=this.domElement.getCaretPosition();if(-1===i)return this.text.width;var e=this.value;if(this.inputOptions.type===t.InputType.password){e="";for(var n=0;n<this.value.length;n++)e+="*"}return this.offscreenText.setText(e.slice(0,i)),this.offscreenText.width},e.prototype.setCaretOnclick=function(t){var i=this.text.toLocal(new PIXI.Point(t.x,t.y),this.game.world).x;this.inputOptions.textAlign&&"center"===this.inputOptions.textAlign&&(i+=this.text.width/2);for(var e=this.text.width/this.value.length,n=0,s=0;s<this.value.length;s++)if(i>=s*e&&(s+1)*e>=i){n=s;break}i>(this.value.length-1)*e&&(n=this.value.length),this.startFocus(),this.domElement.setCaretPosition(n),this.updateCursor()},e.prototype.updateSelection=function(){if(this.domElement.hasSelection){var i=this.value;if(this.inputOptions.type===t.InputType.password){i="";for(var e=0;e<this.value.length;e++)i+="*"}switch(i=i.substring(this.domElement.caretStart,this.domElement.caretEnd),this.offscreenText.setText(i),this.selection.updateSelection(this.offscreenText.getBounds()),this.inputOptions.textAlign){case"left":this.selection.x=this.inputOptions.padding;break;case"center":this.selection.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2}}else this.selection.clear()},e.prototype.zoomIn=function(){if(!t.Plugins.InputField.Zoomed){var i=this.getBounds();window.innerHeight>window.innerWidth?this.windowScale=this.game.width/(1.5*i.width):this.windowScale=this.game.width/2/(1.5*i.width);var e=(this.game.width-1.5*i.width)/2/this.windowScale;this.game.world.scale.set(this.game.world.scale.x*this.windowScale,this.game.world.scale.y*this.windowScale),this.game.world.pivot.set(i.x-e,i.y-2*this.inputOptions.padding),t.Plugins.InputField.Zoomed=!0}},e.prototype.zoomOut=function(){t.Plugins.InputField.Zoomed&&(this.game.world.scale.set(this.game.world.scale.x/this.windowScale,this.game.world.scale.y/this.windowScale),this.game.world.pivot.set(0,0),t.Plugins.InputField.Zoomed=!1)},e.prototype.keyListener=function(t){return this.value=this.domElement.value,13===t.keyCode?(this.endFocus(),void this.enterPressed.dispatch()):(this.updateText(),this.updateCursor(),void this.updateSelection())},e.prototype.destroy=function(){this.domElement.destroy(),i.prototype.destroy.call(this)},e.prototype.resetText=function(){this.setText()},e.prototype.setText=function(t){void 0===t&&(t=""),t.length>0?this.placeHolder.visible=!1:this.placeHolder.visible=!0,this.value=t,this.domElement.value=this.value,this.updateText(),this.updateCursor(),this.endFocus()},e}(Phaser.Sprite);t.InputField=i}(Fabrique||(Fabrique={}));var Fabrique;!function(t){var i=function(t){function i(i,e){t.call(this,i,0,0);var n=e.backgroundColor?parseInt(e.backgroundColor.slice(1),16):16777215,s=e.borderRadius||0,o=e.borderColor?parseInt(e.borderColor.slice(1),16):9803157,h=e.fillAlpha,r=e.height;e.font&&(r=Math.max(parseInt(e.font.substr(0,e.font.indexOf("px")),10),r)),r=2*e.padding+r;var p=e.width;p=2*e.padding+p,this.beginFill(n,h).lineStyle(e.borderWidth||1,o,h),s>0?this.drawRoundedRect(0,0,p,r,s):this.drawRect(0,0,p,r)}return __extends(i,t),i}(Phaser.Graphics);t.InputBox=i}(Fabrique||(Fabrique={}));var Fabrique;!function(t){var i=function(t){function i(i,e){t.call(this,i,e.padding,e.padding),this.inputOptions=e}return __extends(i,t),i.prototype.updateSelection=function(t){var e=Phaser.Color.webToColor(this.inputOptions.selectionColor);this.clear(),this.beginFill(i.rgb2hex(e),e.a),this.drawRect(t.x,t.y,t.width,t.height-this.inputOptions.padding)},i.rgb2hex=function(t){return parseInt(("0"+t.r.toString(16)).slice(-2)+("0"+t.g.toString(16)).slice(-2)+("0"+t.b.toString(16)).slice(-2),16)},i}(Phaser.Graphics);t.SelectionHighlight=i}(Fabrique||(Fabrique={}));var Fabrique;!function(t){var i=function(t){function i(i,e){t.call(this,i,e.padding,e.padding);var n=e.borderRadius,s=e.height;e.font&&(s=Math.max(parseInt(e.font.substr(0,e.font.indexOf("px")),10),s));var o=e.width;this.beginFill(0),n>0?this.drawRoundedRect(0,0,o,s,n):this.drawRect(0,0,o,s)}return __extends(i,t),i}(Phaser.Graphics);t.TextMask=i}(Fabrique||(Fabrique={}));var Fabrique;!function(t){var i;!function(i){var e=function(i){function e(t,e){i.call(this,t,e),this.addInputFieldFactory()}return __extends(e,i),e.prototype.addInputFieldFactory=function(){Phaser.GameObjectFactory.prototype.inputField=function(i,e,n,s){void 0===s&&(s=this.world);var o=new t.InputField(this.game,i,e,n);return s.add(o)},Phaser.GameObjectCreator.prototype.inputField=function(i,e,n){return new t.InputField(this.game,i,e,n)}},e.Zoomed=!1,e.KeyboardOpen=!1,e.onKeyboardOpen=new Phaser.Signal,e.onKeyboardClose=new Phaser.Signal,e}(Phaser.Plugin);i.InputField=e}(i=t.Plugins||(t.Plugins={}))}(Fabrique||(Fabrique={}));