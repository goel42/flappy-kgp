var WebFontConfig,main;main=function(){var e,t,n,o,r,a,l,i,d,s,h,c,u,f,p,g,y,v,w,m,T,b,k,x,P,S,C,A,E,I,B,D,O,M,N,H,L,F,_,j,G,R,U,K,W,Y,q,V,z,J,Z,Q,X,ee,te,ne,oe,re,ae,le,ie,de,se,he,ce,ue,fe,pe,ge,ye,ve,we,me,Te,be,ke,xe,Pe,Se,Ce,Ae,Ee,Ie,Be,De,Oe,Me,Ne;c="flappy",e=!1,h=160,n=1100,t=320,s=1/1200,i=100,d=1,l=6,a=384,u=500,o=64,r=a-o,re=document.querySelector("#screen"),_=void 0,O=void 0,C=[],S=[],P=[],J=[{name:"Arpit",score:"58",hall:"AZ"},{name:"Apoorv",score:"2",hall:"NH"},{name:"Vikrant",score:"1",hall:"RP"},{name:"Arkanath",score:"100",hall:"MS"}],U=["AZ","MT","RP","SN","NH","PT","RK","LLR","MS","LBS","MMM","HJB"],b=null,z=!1,R=!1,y=null,Oe=null,V=null,v=null,j=null,G=null,M=null,ne=null,Z=null,Q=null,te=null,ye=null,ae=null,fe=null,ge=null,q=null,F=null,De=null,H=null,L=null,le=null,I=null,pe=null,Y=null,A=null,Be=null,W=null,k=null,Me=null,xe=null,oe=12,m=null,X=null,B=Math.floor,se=function(e,t){var n,o,r;for(o="",n=r=e;1>=e?1>=r:r>=1;n=1>=e?++r:--r)o+=t[Math.floor(Math.random()*t.length)];return o},w=window.localStorage.getItem("browserKey"),w||(w=se(32,"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),window.localStorage.setItem("browserKey",w)),Pe=function(e,t){var n,o,r;return n=null,o=t?"tubeTop":"tubeBottom",r=B(t?e-i/2-320:e+i/2),C.length>0&&"tubeTop"===o?(n=C.pop().revive(),n.reset(D.world.width,r)):S.length>0&&"tubeBottom"===o?(n=S.pop().revive(),n.reset(D.world.width,r)):(n=Oe.create(D.world.width,r,o),D.physics.arcade.enableBody(n),n.body.allowGravity=!1),n.body.velocity.x=-h,n},Se=function(){var e,t,n,o;Oe.forEachAlive(function(e){e.x+e.width<D.world.bounds.left&&("tubeTop"===e.key&&C.push(e.kill()),"tubeBottom"===e.key&&S.push(e.kill()))}),V.forEachAlive(function(e){e.x+e.width<D.world.bounds.left&&P.push(e.kill())}),o=D.world.height/2+(Math.random()-.5)*D.world.height*.2,e=Pe(o),n=Pe(o,!0),P.length>0?t=P.pop().revive().reset(n.x+n.width/2,0):(t=V.create(n.x+n.width/2,0),D.physics.arcade.enableBody(t),t.width=2,t.height=D.world.height,t.body.allowGravity=!1),t.body.velocity.x=-h},g=function(e,t){V.remove(t),fe+=1,ge.setText(fe),pe.play()},Te=function(e){var t,n,o,r,a,l,i;for(o="",n="",r="",Z.children[1].setText("Loading.."),Z.children[2].setText(""),Z.children[0].setText(""),a=l=3,i=Z.children.length-1;i>=3?i>=l:l>=i;a=i>=3?++l:--l)Z.children[a].kill();return Z.children[9].revive(),Z.children[10].revive(),t=function(){var e,t,a,l;for(t=a=0,l=J.length-1;l>=0?l>=a:a>=l;t=l>=0?++a:--a)J[t].score<0?(o+="\n-",n+="\n---",r+="\n---",Z.children[3+t].kill()):(o+="\n"+(t+1),n+="\n"+J[t].hall,r+="\n"+J[t].score,e=Z.children[3+t],e.revive(),e.frameName=J[t].hall+"/2",e.children[0].setText(J[t].hall));return Z.children[0].setText(o),Z.children[1].setText(n),Z.children[2].setText(r),Z.children[9].bringToTop()},$.when(e).done(function(e){return $.ajax({type:"GET",url:"/getLeaderboardHall",success:function(e){return J=e,ue(),t()},error:function(){return J=[],ue(),t()}})})},me=function(){return Q.kill(),$.ajax({type:"GET",url:"/getLeader",success:function(e){return 0!==e.length?(Q.revive(),Q.frameName=e[0].hall+"/2",Q.animations.getAnimation("fly")&&Q.animations.getAnimation("fly").destroy(),Q.animations.add("fly",Phaser.Animation.generateFrameNames(e[0].hall+"/",1,3,"",1),10,!0),Q.animations.play("fly"),Q.children[0].setText(e[0].hall)):void 0},error:function(){}})},be=function(e){var t,n,o,r,a,l,i;for(o="",n="",r="",Z.children[1].setText("Loading.."),Z.children[2].setText(""),Z.children[0].setText(""),a=l=3,i=Z.children.length-1;i>=3?i>=l:l>=i;a=i>=3?++l:--l)Z.children[a].kill();return Z.children[9].revive(),Z.children[10].revive(),t=function(){var e,t,a,l;for(t=a=0,l=J.length-1;l>=0?l>=a:a>=l;t=l>=0?++a:--a)J[t].score<0?(o+="\n-",n+="\n---",r+="\n---",Z.children[3+t].kill()):(o+="\n"+(t+1),n+="\n"+J[t].name,r+="\n"+J[t].score,e=Z.children[3+t],e.revive(),e.frameName=J[t].hall+"/2",e.children[0].setText(J[t].hall));return Z.children[0].setText(o),Z.children[1].setText(n),Z.children[2].setText(r),Z.children[9].bringToTop()},$.when(e).done(function(e){return $.ajax({type:"GET",url:"/getLeaderboardSolo",success:function(e){return J=e,ue(),t()},error:function(){return J=[],ue(),t()}})})},ue=function(){for(J.sort(function(e,t){return parseInt(e.score)<parseInt(t.score)});J.length<l;)J.push({name:"---",score:"-1",hall:"DUMMY2"});return J},ve=function(){var e;return e={score:fe,name:ae,hall:U[b],key:ye,token:K(fe+ye+c+fe),browserKey:w},$.ajax({type:"POST",data:e,dataType:"text",url:"/sendScore",success:function(e){},error:function(){}})},ke=function(){var e,t;return Z.frame=0,e=ve(),X.input.enabled=!1,M.alive?(t=D.add.tween(M).to({y:1.5*D.world.height},800,Phaser.Easing.Back.In,!0),Be.play(),xe.onDown.removeAll(),y.events.onInputDown.removeAll(),t.onComplete.add(function(){return M.kill(),Z.revive(),Z.bringToTop(),t=D.add.tween(Z).to({y:D.world.height/2},800,Phaser.Easing.Back.Out,!0),Te(e),t.onComplete.add(function(){var e;return e=function(){return Z.alive?(t=D.add.tween(Z).to({y:1.5*D.world.height},800,Phaser.Easing.Back.In,!0),Be.play(),xe.onDown.removeAll(),y.events.onInputDown.removeAll(),t.onComplete.add(function(){return Z.kill(),ce()})):ce()},y.events.onInputDown.addOnce(e),xe.onDown.addOnce(e)})})):void 0},p=function(e,t,n){var o;return o=D.add.sprite(e,t,"sheet",U[n]+"/2"),o.scale.setTo(2,2),o.smoothed=!1,o.anchor.setTo(.5,.5),o},Ae=function(){return y.inputEnabled=!1,xe.onDown.removeAll(),le.startFocus(),le.focus=!0,le.placeHolder.visible=!1},Ie=function(){return le.endFocus(),le.focus=!1,y.inputEnabled=!0},N=function(){var e;return xe.onDown.removeAll(),y.events.onInputDown.removeAll(),M.revive(),me(),X.input.enabled=!1,M.bringToTop(),e=D.add.tween(M).to({y:D.world.height/2},800,Phaser.Easing.Back.Out,!0),e.onComplete.add(function(){var t;return X.input.enabled=!0,t=function(){return ve(),X.input.enabled=!1,M.alive?(e=D.add.tween(M).to({y:1.5*D.world.height},800,Phaser.Easing.Back.In,!0),Be.play(),xe.onDown.removeAll(),y.events.onInputDown.removeAll(),e.onComplete.add(function(){return M.kill(),ce()})):ce()},y.events.onInputDown.addOnce(t),xe.onDown.addOnce(t)}),Be.play()},we=function(){var e;O=!0,v.body.velocity.y>0&&(v.body.velocity.y=100),v.animations.stop(),v.frame=U[b]+"/2",e=window.localStorage.getItem("hiscore"),e=e?e:fe,e=fe>parseInt(e,10)?fe:e,window.localStorage.setItem("hiscore",e),H.setText(fe),L.setText(e),Oe.forEachAlive(function(e){e.body.velocity.x=0}),V.forEach(function(e){e.body.velocity.x=0}),D.time.events.remove(Me),D.time.events.add(1e3,function(){return z?N():ee(N)}),Y.play()},E=function(){var e;_||Ce(),O||(v.body.gravity.y=0,v.body.velocity.y=-100,e=D.add.tween(v.body.velocity).to({y:-t},25,Phaser.Easing.Bounce.In,!0),e.onComplete.add(function(){return v.body.gravity.y=n}),I.play())},de=function(){var e;D.load.atlasJSONHash("sheet","assets/sheet.png","assets/sheet.json"),e={spritesheet:{leaderboard:["assets/leaderboard.png",52,29],lbPanel:["assets/lbPanel.png",448,320]},image:{tubeTop:["assets/tube1.png"],tubeBottom:["assets/tube2.png"],ground:["assets/path.png"],bg:["assets/bg2.png"],hall:["assets/hall.png"],gameover:["assets/gameover-panel.png"],nameScreen:["assets/name.png"]},audio:{flap:["assets/sfx_wing.mp3"],score:["assets/sfx_point.mp3"],hurt:["assets/sfx_hit.mp3"],fall:["assets/sfx_die.mp3"],swoosh:["assets/sfx_swooshing.mp3"],click:["assets/keyboard_tap.mp3"],hover:["assets/typewriter_key.mp3"]}},Object.keys(e).forEach(function(t){Object.keys(e[t]).forEach(function(n){D.load[t].apply(D.load,[n].concat(e[t][n]))})})},K=function(e){var t,n,o,r,a,l;if(n=0,0===e.length)return n;for(r=e.length,o=a=0,l=r-1;l>=0?l>=a:a>=l;o=l>=0?++a:--a)t=e.charCodeAt(o),n=(n<<5)-n+t,n|=0;return n},x=function(){var e,t,n,i,s,h,c,f,g,w,b,x,P,S,C,E,B,O,N,_,G,R;for(D.add.plugin(Fabrique.Plugins.InputField),g=window.localStorage.getItem("name"),g&&(z=!0,ae=g),D.physics.startSystem(Phaser.Physics.ARCADE),console.log("%chttps://github.com/korroktheslavemaster/flappy-kgp","color: black; font-size: x-large"),x=window.innerWidth/window.innerHeight,document.querySelector("#loading").style.display="none",D.scale.pageAlignVertically=!0,D.smoothed=!1,D.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,D.scale.windowConstraints.bottom="visual",D.scale.setGameSize(u,a),y=D.add.tileSprite(0,0,u,a,"bg"),y.smoothed=!0,y.inputEnabled=!0,y.input.priorityID=0,v=D.add.sprite(0,0),Oe=D.add.group(),V=D.add.group(),te=D.add.group(void 0,void 0,!1,!0,Phaser.Physics.ARCADE),j=D.add.tileSprite(0,r,u,o,"ground"),j.tileScale.setTo(d,d),ge=D.add.text(D.world.width/2,D.world.height/4,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),ge.anchor.setTo(.5,.5),q=D.add.text(D.world.width/2,D.world.height-D.world.height/4,"",{font:'8px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),q.anchor.setTo(.5,.5),F=D.add.text(D.world.width/2,D.world.height/2,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),F.anchor.setTo(.5,.5),F.scale.setTo(d,d),Z=D.add.sprite(D.world.width/2,1.5*D.world.height,"lbPanel",0),Z.anchor.setTo(.5,.5),Z.kill(),E=D.add.text(-170,0,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),E.anchor.setTo(.5,.5),C=D.add.text(20,0,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"left"}),C.anchor.setTo(.5,.5),B=D.add.text(150,0,"",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"right"}),B.anchor.setTo(.5,.5),G=[E,C,B],O=0,_=G.length;_>O;O++)S=G[O],S.lineSpacing=15;for(Z.addChild(E),Z.addChild(C),Z.addChild(B),c=N=0,R=l-1;R>=0?R>=N:N>=R;c=R>=0?++N:--N)P=p(-120,-105+41*c+10,0),n=D.add.text(0,10,"",{font:'16px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),n.scale.setTo(.5,.5),n.smoothed=!1,n.anchor.setTo(.5,.5),P.addChild(n),P.kill(),Z.addChild(P);e=D.add.button(0-Z.width/2,0-Z.height/2,void 0,function(){return Z.frame=0,Te(void 0)},this),e.events.onInputUp.add(function(){return k.play()}),e.width=100,e.height=33,t=D.add.button(104-Z.width/2,0-Z.height/2,void 0,function(){return Z.frame=1,be(void 0)},this),t.events.onInputUp.add(function(){return k.play()}),t.width=100,t.height=33,e.bringToTop(),t.bringToTop(),Z.addChild(e),Z.addChild(t),ne=D.add.sprite(0,0,"nameScreen",void 0,te),ne.anchor.setTo(.5,.5),ne.kill(),te.x=D.world.width/2,te.y=1.5*D.world.height,M=D.add.sprite(D.world.width/2,1.5*D.world.height,"gameover"),M.anchor.setTo(.5,.5),M.kill(),De=D.add.text(0,M.height/2-20,"Touch to Try Again",{font:'8px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),De.anchor.setTo(.5,.5),M.addChild(De),h=D.add.text(M.width/4-10,-30,"Score\n\nBest",{font:'24px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"left"}),h.anchor.setTo(0,0),M.addChild(h),f=D.add.text(-M.width/3-60,0,"Leader-\nboard -->",{font:'6px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"left"}),f.anchor.setTo(0,.5),M.addChild(f),i=D.add.text(-M.width/3-20,60,"Current\nLeader:",{font:'8px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"left"}),i.anchor.setTo(0,0),M.addChild(i),H=D.add.text(M.width/4-10,0,"",{font:'16px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"left"}),H.anchor.setTo(0,0),M.addChild(H),L=D.add.text(M.width/4-10,68,"",{font:'16px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"left"}),L.anchor.setTo(0,0),M.addChild(L),Q=D.add.sprite(100,10,"sheet","NH/2"),Q.scale.setTo(2,2),Q.smoothed=!1,Q.anchor.setTo(.5,.5),i.addChild(Q),s=D.add.text(0,10,"",{font:'16px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),s.scale.setTo(.5,.5),s.smoothed=!1,s.anchor.setTo(.5,.5),Q.addChild(s),X=D.add.button(-90,0,"leaderboard",ke,this,2,0,1,0),X.events.onInputUp.add(function(){return k.play()}),X.events.onInputOver.add(function(){return W.play()}),X.scale.setTo(2,2),X.anchor.setTo(.5,.5),X.smoothed=!1,M.addChild(X),b=D.add.text(0,-30,"Enter Name",{font:'16px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),b.anchor.setTo(.5,.5),ne.addChild(b),w=D.add.text(0,60,"Press Enter to continue",{font:'8px "Press Start 2P"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),w.anchor.setTo(.5,.5),ne.addChild(w),le=D.add.inputField(-75,10,{font:'16px "Press Start 2P"',fill:"#430",cursorColor:"#430",backgroundColor:"#ffffff",placeHolder:"name",placeHolderColor:"#874",height:30,width:150,type:Fabrique.InputType.text},te),le.anchor.setTo(0,.3),le.bringToTop(),I=D.add.audio("flap"),I.allowMultiple=!0,pe=D.add.audio("score"),Y=D.add.audio("hurt"),A=D.add.audio("fall"),Be=D.add.audio("swoosh"),W=D.add.audio("hover"),k=D.add.audio("click"),v.kill(),m=[],T()},T=function(){var e,t,n,o,r,a,l,i,d,s,h,c;for(Be.play(),G=D.add.sprite(D.world.width/2,1.5*D.world.height,"hall"),n=D.add.text(0,-100,"Choose Carefully",{font:'30px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),n.renderable=!0,n.anchor.setTo(.5,.5),G.addChild(n),G.anchor.setTo(.5,.5),t=G.width-50,e=G.height-100,a=c=1;oe>=1?oe>=c:c>=oe;a=oe>=1?++c:--c)a-=1,o=parseInt(a/4),r=a%4,l=-G.width/2+72,i=-G.height/2+120,s=Math.round(t/4*r+l),h=Math.round(e/3*o+i),G.addChild(f(s,h,a+1));return d=D.add.tween(G).to({y:D.world.height/2},800,Phaser.Easing.Back.Out,!0)},f=function(e,t,n){var o,r;return r=D.add.button(e,t,"sheet",function(){return R?void 0:ie(n)},this,U[n-1]+"/3",U[n-1]+"/2",U[n-1]+"/1",U[n-1]+"/2"),r.smoothed=!1,r.anchor.setTo(.5,.5),r.animations.add("onHover",[U[n-1]+"/1",U[n-1]+"/2",U[n-1]+"/3",U[n-1]+"/2"],10,!0),r.scale.setTo(2,2),r.smoothed=!1,r.trueY=t,o=D.add.text(0,10,U[n-1],{font:'16px "04b_19regular"',fill:"#fff",stroke:"#430",strokeThickness:4,align:"center"}),o.scale.setTo(.5,.5),o.smoothed=!1,o.anchor.setTo(.5,.5),r.addChild(o),r.setOverSound(k),r.setUpSound(Be),r.events.onInputOver.add(function(){return r.play("onHover",10,!0,!1),r.doBounce=!0}),r.events.onInputOut.add(function(){return r.animations.stop(),r.doBounce=!1}),r.doBounce=!1,m.push(r),r},ie=function(e){var t,n,o,r;for(R=!0,b=e-1,o=0,r=m.length;r>o;o++)t=m[o],t.setOverSound(null),t.setUpSound(null);return v=D.add.sprite(0,0,"sheet",U[e-1]+"/2"),v.scale.setTo(2,2),v.anchor.setTo(.5,.5),D.physics.arcade.enableBody(v),G.bringToTop(),v.animations.add("fly",Phaser.Animation.generateFrameNames(U[e-1]+"/",1,3,"",1),10,!0),v.body.collideWorldBounds=!0,n=D.add.tween(G).to({y:1.5*D.world.height},800,Phaser.Easing.Back.In,!0),n.onComplete.add(function(){var e,n;for(e=0,n=m.length;n>e;e++)t=m[e],t.destroy();return G.destroy()}),v.angle=0,v.revive(),xe=D.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),xe.onDown.add(E),y.events.onInputDown.add(E),y.events.onInputDown.add(function(){}),ce()},ce=function(){xe.onDown.removeAll(),y.events.onInputDown.removeAll(),xe.onDown.add(E),y.events.onInputDown.add(E),_=!1,O=!1,fe=0,ge.setText("Flappy Bird 2.2 Edition"),q.setText("TOUCH TO FLY\nFLAP bird WINGS"),F.renderable=!1,v.smoothed=!1,v.body.allowGravity=!1,v.reset(.3*D.world.width,D.world.height/2),v.angle=0,v.animations.play("fly"),Oe.removeAll(),V.removeAll()},Ce=function(){var e;e={key:ye},$.ajax({type:"POST",data:e,dataType:"text",url:"/initGame",success:function(e){},error:function(){}}),_=!0,D.time.events.remove(Me),v.body.allowGravity=!0,v.body.gravity.y=n,Me=D.time.events.loop(1/s,Se),ge.setText(fe),q.renderable=!1},Ne=function(){var e,n,o,a;if(_?O?(n=D.add.tween(v).to({angle:90},100,Phaser.Easing.Bounce.Out,!0),v.body.bottom>=r+3&&(v.y=r-13,v.body.velocity.y=0,v.body.allowGravity=!1,v.body.gravity.y=0)):(v.angle=90*(t+v.body.velocity.y)/t-180,v.angle<-30&&(v.angle=-30),v.angle>80?(v.angle=90,v.animations.stop("fly"),v.frame=U[b]+"/2"):v.animations.play("fly"),D.physics.arcade.overlap(v,Oe,function(){return we(),A.play()}),!O&&v.body.bottom>=r&&we(),D.physics.arcade.overlap(v,V,g)):(v.y=D.world.height/2+8*Math.cos(D.time.now/200),v.angle=0),O&&(Q.y=10+5*Math.cos(D.time.now/200)),!R)for(o=0,a=m.length;a>o;o++)e=m[o],e.doBounce?e.y=e.trueY+5*Math.cos(D.time.now/200):e.y=e.trueY;O||(y.tilePosition.x-=D.time.physicsElapsed*h/5),O||(j.tilePosition.x-=D.time.physicsElapsed*h)},ee=function(e){var t;return Ae(),ne.revive(),D.world.bringToTop(te),t=D.add.tween(te).to({y:D.world.height/2},800,Phaser.Easing.Back.Out,!0),t.onComplete.add(function(){return le.addEnterCallback(function(){return Ie(),z=!0,ae=le.value,window.localStorage.setItem("name",ae),t=D.add.tween(te).to({y:1.5*D.world.height},800,Phaser.Easing.Back.In,!0),Be.play(),t.onComplete.add(function(){return ne.kill(),e()})})}),Be.play()},he=function(){e&&(D.debug.body(v),Oe.forEachAlive(function(e){D.debug.body(e)}),V.forEach(function(e){D.debug.body(e)}))},Ee={preload:de,create:x,update:Ne,render:he},D=new Phaser.Game(u,a,Phaser.CANVAS,re,Ee,!1,!1),ye=se(32,"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ")},WebFontConfig={google:{families:["Press+Start+2P::latin"]},active:main},function(){var e,t;return t=document.createElement("script"),t.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",t.type="text/javascript",t.async="true",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)}();
var Fabrique;!function(t){!function(t){t[t.text=0]="text",t[t.password=1]="password",t[t.number=2]="number"}(t.InputType||(t.InputType={}));var i=t.InputType,e=function(){function t(t,e,n,s){var o=this;void 0===n&&(n=i.text),void 0===s&&(s=""),this.focusIn=new Phaser.Signal,this.focusOut=new Phaser.Signal,this.id=e,this.type=n,this.game=t,this.element=document.createElement("input"),this.element.id=e,this.element.style.position="absolute",this.element.style.top=(-100).toString()+"px",this.element.style.left=(-100).toString()+"px",this.element.value=this.value,this.element.type=i[n],this.element.addEventListener("focusin",function(){o.focusIn.dispatch()}),this.element.addEventListener("focusout",function(){o.focusOut.dispatch()}),document.body.appendChild(this.element)}return t.prototype.addKeyUpListener=function(t){this.callback=t,document.addEventListener("keyup",this.callback)},t.prototype.removeEventListener=function(){document.removeEventListener("keyup",this.callback)},t.prototype.destroy=function(){document.body.removeChild(this.element)},t.prototype.setMax=function(t,e){if(void 0!==t)if(this.type===i.text||this.type===i.password)this.element.maxLength=parseInt(t,10);else if(this.type===i.number){if(this.element.max=t,void 0===e)return;this.element.min=e}},Object.defineProperty(t.prototype,"value",{get:function(){return this.element.value},set:function(t){this.element.value=t},enumerable:!0,configurable:!0}),t.prototype.focus=function(){var t=this;if(this.element.focus(),!this.game.device.desktop&&this.game.device.chrome)var i=window.innerWidth,e=window.innerHeight,n=!1,s=setInterval(function(){(i>window.innerWidth||e>window.innerHeight)&&(n=!0),n&&i===window.innerWidth&&e===window.innerHeight&&(t.focusOut.dispatch(),clearInterval(s))},50)},t.prototype.blur=function(){this.element.blur()},Object.defineProperty(t.prototype,"hasSelection",{get:function(){return this.type===i.number?!1:this.element.selectionStart!==this.element.selectionEnd},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"caretStart",{get:function(){return this.element.selectionEnd},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"caretEnd",{get:function(){return this.element.selectionStart},enumerable:!0,configurable:!0}),t.prototype.getCaretPosition=function(){return this.type===i.number?-1:this.element.selectionStart},t.prototype.setCaretPosition=function(t){this.type!==i.number&&this.element.setSelectionRange(t,t)},t}();t.InputElement=e}(Fabrique||(Fabrique={}));var __extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},Fabrique;!function(t){var i=function(i){function e(e,n,s,o){var h=this;switch(void 0===o&&(o={}),i.call(this,e,n,s),this.placeHolder=null,this.box=null,this.focus=!1,this.value="",this.windowScale=1,this.enterPressed=new Phaser.Signal,this.blink=!0,this.cnt=0,this.inputOptions=o,this.inputOptions.width=o.width||150,this.inputOptions.padding=o.padding||0,this.inputOptions.textAlign=o.textAlign||"left",this.inputOptions.type=o.type||t.InputType.text,this.inputOptions.borderRadius=o.borderRadius||0,this.inputOptions.height=o.height||14,this.inputOptions.fillAlpha=void 0===o.fillAlpha?1:o.fillAlpha,this.inputOptions.selectionColor=o.selectionColor||"rgba(179, 212, 253, 0.8)",this.inputOptions.zoom=e.device.desktop?!1:o.zoom||!1,this.box=new t.InputBox(this.game,o),this.setTexture(this.box.generateTexture()),this.textMask=new t.TextMask(this.game,o),this.addChild(this.textMask),this.domElement=new t.InputElement(this.game,"phaser-input-"+(1e4*Math.random()|0).toString(),this.inputOptions.type,this.value),this.domElement.setMax(this.inputOptions.max,this.inputOptions.min),this.selection=new t.SelectionHighlight(this.game,this.inputOptions),this.addChild(this.selection),o.placeHolder&&o.placeHolder.length>0&&(this.placeHolder=new Phaser.Text(e,this.inputOptions.padding,this.inputOptions.padding,o.placeHolder,{font:o.font||"14px Arial",fontWeight:o.fontWeight||"normal",fill:o.placeHolderColor||"#bfbebd"}),this.placeHolder.mask=this.textMask,this.addChild(this.placeHolder)),this.cursor=new Phaser.Text(e,this.inputOptions.padding,this.inputOptions.padding-2,"|",{font:o.font||"14px Arial",fontWeight:o.fontWeight||"normal",fill:o.cursorColor||"#000000"}),this.cursor.visible=!1,this.addChild(this.cursor),this.text=new Phaser.Text(e,this.inputOptions.padding,this.inputOptions.padding,"",{font:o.font||"14px Arial",fontWeight:o.fontWeight||"normal",fill:o.fill||"#000000"}),this.text.mask=this.textMask,this.addChild(this.text),this.offscreenText=new Phaser.Text(e,this.inputOptions.padding,this.inputOptions.padding,"",{font:o.font||"14px Arial",fontWeight:o.fontWeight||"normal",fill:o.fill||"#000000"}),this.inputOptions.textAlign){case"left":this.text.anchor.set(0,0),this.cursor.x=this.inputOptions.padding+this.getCaretPosition();break;case"center":this.text.anchor.set(.5,0),this.text.x+=this.inputOptions.width/2,this.cursor.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2+this.getCaretPosition();break;case"right":this.text.anchor.set(1,0),this.text.x+=this.inputOptions.width,this.cursor.x=this.inputOptions.padding+this.inputOptions.width}this.inputEnabled=!0,this.input.useHandCursor=!0,this.game.input.onDown.add(this.checkDown,this),this.domElement.focusOut.add(function(){t.Plugins.InputField.KeyboardOpen&&(h.endFocus(),h.inputOptions.zoom&&h.zoomOut())})}return __extends(e,i),e.prototype.checkDown=function(i){if(this.input.checkPointerOver(i)){if(this.focus)return void this.setCaretOnclick(i);null!==this.placeHolder&&(this.placeHolder.visible=!1),this.inputOptions.zoom&&!t.Plugins.InputField.Zoomed&&this.zoomIn(),this.startFocus()}else this.focus===!0&&(this.endFocus(),this.inputOptions.zoom&&this.zoomOut())},e.prototype.update=function(){if(this.focus){if(30!==this.cnt)return this.cnt++;this.cursor.visible=this.blink,this.blink=!this.blink,this.cnt=0}},e.prototype.endFocus=function(){var i=this;this.domElement.removeEventListener(),this.focus=!1,0===this.value.length&&null!==this.placeHolder&&(this.placeHolder.visible=!0),this.cursor.visible=!1,this.game.device.desktop?setTimeout(function(){i.domElement.blur()},0):this.domElement.blur(),this.game.device.desktop||(t.Plugins.InputField.KeyboardOpen=!1,t.Plugins.InputField.onKeyboardClose.dispatch())},e.prototype.addEnterCallback=function(t){this.enterPressed.add(t)},e.prototype.startFocus=function(){var i=this;this.focus=!0,this.domElement.addKeyUpListener(this.keyListener.bind(this)),this.game.device.desktop?setTimeout(function(){i.domElement.focus()},0):this.domElement.focus(),this.game.device.desktop||(t.Plugins.InputField.KeyboardOpen=!0,t.Plugins.InputField.onKeyboardOpen.dispatch())},e.prototype.updateText=function(){var i="";if(this.inputOptions.type===t.InputType.password)for(var e=0;e<this.value.length;e++)i+="*";else if(this.inputOptions.type===t.InputType.number){var n=parseInt(this.value);i=n<parseInt(this.inputOptions.min)?this.inputOptions.min:n>parseInt(this.inputOptions.max)?this.inputOptions.max:this.value}else i=this.value;if(this.text.setText(i),this.text.width>this.inputOptions.width)this.text.anchor.x=1,this.text.x=this.inputOptions.padding+this.inputOptions.width;else switch(this.inputOptions.textAlign){case"left":this.text.anchor.set(0,0),this.text.x=this.inputOptions.padding;break;case"center":this.text.anchor.set(.5,0),this.text.x=this.inputOptions.padding+this.inputOptions.width/2;break;case"right":this.text.anchor.set(1,0),this.text.x=this.inputOptions.padding+this.inputOptions.width}},e.prototype.updateCursor=function(){if(this.text.width>this.inputOptions.width||"right"===this.inputOptions.textAlign)this.cursor.x=this.inputOptions.padding+this.inputOptions.width;else switch(this.inputOptions.textAlign){case"left":this.cursor.x=this.inputOptions.padding+this.getCaretPosition();break;case"center":this.cursor.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2+this.getCaretPosition()}},e.prototype.getCaretPosition=function(){var i=this.domElement.getCaretPosition();if(-1===i)return this.text.width;var e=this.value;if(this.inputOptions.type===t.InputType.password){e="";for(var n=0;n<this.value.length;n++)e+="*"}return this.offscreenText.setText(e.slice(0,i)),this.offscreenText.width},e.prototype.setCaretOnclick=function(t){var i=this.text.toLocal(new PIXI.Point(t.x,t.y),this.game.world).x;this.inputOptions.textAlign&&"center"===this.inputOptions.textAlign&&(i+=this.text.width/2);for(var e=this.text.width/this.value.length,n=0,s=0;s<this.value.length;s++)if(i>=s*e&&(s+1)*e>=i){n=s;break}i>(this.value.length-1)*e&&(n=this.value.length),this.startFocus(),this.domElement.setCaretPosition(n),this.updateCursor()},e.prototype.updateSelection=function(){if(this.domElement.hasSelection){var i=this.value;if(this.inputOptions.type===t.InputType.password){i="";for(var e=0;e<this.value.length;e++)i+="*"}switch(i=i.substring(this.domElement.caretStart,this.domElement.caretEnd),this.offscreenText.setText(i),this.selection.updateSelection(this.offscreenText.getBounds()),this.inputOptions.textAlign){case"left":this.selection.x=this.inputOptions.padding;break;case"center":this.selection.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2}}else this.selection.clear()},e.prototype.zoomIn=function(){if(!t.Plugins.InputField.Zoomed){var i=this.getBounds();window.innerHeight>window.innerWidth?this.windowScale=this.game.width/(1.5*i.width):this.windowScale=this.game.width/2/(1.5*i.width);var e=(this.game.width-1.5*i.width)/2/this.windowScale;this.game.world.scale.set(this.game.world.scale.x*this.windowScale,this.game.world.scale.y*this.windowScale),this.game.world.pivot.set(i.x-e,i.y-2*this.inputOptions.padding),t.Plugins.InputField.Zoomed=!0}},e.prototype.zoomOut=function(){t.Plugins.InputField.Zoomed&&(this.game.world.scale.set(this.game.world.scale.x/this.windowScale,this.game.world.scale.y/this.windowScale),this.game.world.pivot.set(0,0),t.Plugins.InputField.Zoomed=!1)},e.prototype.keyListener=function(t){return this.value=this.domElement.value,13===t.keyCode?(this.endFocus(),void this.enterPressed.dispatch()):(this.updateText(),this.updateCursor(),void this.updateSelection())},e.prototype.destroy=function(){this.domElement.destroy(),i.prototype.destroy.call(this)},e.prototype.resetText=function(){this.setText()},e.prototype.setText=function(t){void 0===t&&(t=""),t.length>0?this.placeHolder.visible=!1:this.placeHolder.visible=!0,this.value=t,this.domElement.value=this.value,this.updateText(),this.updateCursor(),this.endFocus()},e}(Phaser.Sprite);t.InputField=i}(Fabrique||(Fabrique={}));var Fabrique;!function(t){var i=function(t){function i(i,e){t.call(this,i,0,0);var n=e.backgroundColor?parseInt(e.backgroundColor.slice(1),16):16777215,s=e.borderRadius||0,o=e.borderColor?parseInt(e.borderColor.slice(1),16):9803157,h=e.fillAlpha,r=e.height;e.font&&(r=Math.max(parseInt(e.font.substr(0,e.font.indexOf("px")),10),r)),r=2*e.padding+r;var p=e.width;p=2*e.padding+p,this.beginFill(n,h).lineStyle(e.borderWidth||1,o,h),s>0?this.drawRoundedRect(0,0,p,r,s):this.drawRect(0,0,p,r)}return __extends(i,t),i}(Phaser.Graphics);t.InputBox=i}(Fabrique||(Fabrique={}));var Fabrique;!function(t){var i=function(t){function i(i,e){t.call(this,i,e.padding,e.padding),this.inputOptions=e}return __extends(i,t),i.prototype.updateSelection=function(t){var e=Phaser.Color.webToColor(this.inputOptions.selectionColor);this.clear(),this.beginFill(i.rgb2hex(e),e.a),this.drawRect(t.x,t.y,t.width,t.height-this.inputOptions.padding)},i.rgb2hex=function(t){return parseInt(("0"+t.r.toString(16)).slice(-2)+("0"+t.g.toString(16)).slice(-2)+("0"+t.b.toString(16)).slice(-2),16)},i}(Phaser.Graphics);t.SelectionHighlight=i}(Fabrique||(Fabrique={}));var Fabrique;!function(t){var i=function(t){function i(i,e){t.call(this,i,e.padding,e.padding);var n=e.borderRadius,s=e.height;e.font&&(s=Math.max(parseInt(e.font.substr(0,e.font.indexOf("px")),10),s));var o=e.width;this.beginFill(0),n>0?this.drawRoundedRect(0,0,o,s,n):this.drawRect(0,0,o,s)}return __extends(i,t),i}(Phaser.Graphics);t.TextMask=i}(Fabrique||(Fabrique={}));var Fabrique;!function(t){var i;!function(i){var e=function(i){function e(t,e){i.call(this,t,e),this.addInputFieldFactory()}return __extends(e,i),e.prototype.addInputFieldFactory=function(){Phaser.GameObjectFactory.prototype.inputField=function(i,e,n,s){void 0===s&&(s=this.world);var o=new t.InputField(this.game,i,e,n);return s.add(o)},Phaser.GameObjectCreator.prototype.inputField=function(i,e,n){return new t.InputField(this.game,i,e,n)}},e.Zoomed=!1,e.KeyboardOpen=!1,e.onKeyboardOpen=new Phaser.Signal,e.onKeyboardClose=new Phaser.Signal,e}(Phaser.Plugin);i.InputField=e}(i=t.Plugins||(t.Plugins={}))}(Fabrique||(Fabrique={}));